<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Poker House</title>
    <!-- Critical: Show loading indicator immediately -->
    <style>
        .initial-loader {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: #0a0f18;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 99999;
            color: #fb923c;
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
        }
        .initial-loader.loaded { display: none; }
        .loader-spinner {
            width: 50px; height: 50px;
            border: 4px solid #1a2332;
            border-top-color: #fb923c;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        .loader-text { margin-top: 20px; font-size: 18px; }
    </style>
    <script>
        // Load Telegram SDK with timeout fallback
        var tgScriptLoaded = false;
        var tgScript = document.createElement('script');
        tgScript.src = 'https://telegram.org/js/telegram-web-app.js';
        tgScript.onload = function() { tgScriptLoaded = true; };
        tgScript.onerror = function() { console.log('TG SDK failed to load'); };
        document.head.appendChild(tgScript);
        
        // Fallback: continue without SDK after 3 seconds
        setTimeout(function() {
            if (!tgScriptLoaded) {
                console.log('TG SDK timeout - continuing without it');
            }
        }, 3000);
    </script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            background: radial-gradient(ellipse at top, #1a2332 0%, #0a0f18 50%, #050810 100%);
            color: #e2e8f0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .hidden { display: none !important; }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           SPLASH SCREEN STYLES
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        #splashScreen {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            z-index: 9999;
            background: radial-gradient(ellipse at center, #1a2840 0%, #0d1520 40%, #050810 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .splash-bg-glow {
            position: absolute;
            width: 300px; height: 300px;
            background: radial-gradient(circle, rgba(251,146,60,0.15) 0%, transparent 70%);
            border-radius: 50%;
            animation: pulseGlow 2s ease-in-out infinite;
        }

        @keyframes pulseGlow {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.2); opacity: 0.8; }
        }

        .splash-title {
            font-size: 32px;
            font-weight: 700;
            color: #f8fafc;
            margin-bottom: 30px;
            opacity: 0;
            transform: translateY(-30px);
            animation: fadeInDown 0.6s ease-out 0.3s forwards;
        }

        .splash-cowboy {
            font-size: 80px;
            margin-bottom: 24px;
            transform: scale(0);
            animation: bounceIn 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55) 0.1s forwards;
        }

        .splash-wave {
            display: inline-block;
            animation: wave 1s ease-in-out infinite;
            transform-origin: 70% 70%;
        }

        @keyframes wave {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(20deg); }
            75% { transform: rotate(-10deg); }
        }

        @keyframes bounceIn {
            0% { transform: scale(0); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        @keyframes fadeInDown {
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeInUp {
            to { opacity: 1; transform: translateY(0); }
        }

        /* â•â•â•â•â•â•â• SCREEN TRANSITION ANIMATIONS â•â•â•â•â•â•â• */
        .screen-transition {
            transition: opacity 0.3s ease-out, transform 0.3s ease-out;
        }
        
        .screen-fade-in {
            animation: screenFadeIn 0.4s ease-out forwards;
        }
        
        .screen-fade-out {
            animation: screenFadeOut 0.3s ease-out forwards;
        }
        
        .screen-slide-in {
            animation: screenSlideIn 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
        }
        
        .screen-slide-out {
            animation: screenSlideOut 0.3s ease-in forwards;
        }
        
        @keyframes screenFadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        
        @keyframes screenFadeOut {
            from { opacity: 1; transform: scale(1); }
            to { opacity: 0; transform: scale(0.95); }
        }
        
        @keyframes screenSlideIn {
            from { opacity: 0; transform: translateX(30px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        @keyframes screenSlideOut {
            from { opacity: 1; transform: translateX(0); }
            to { opacity: 0; transform: translateX(-30px); }
        }

        .splash-phrase {
            font-size: 18px;
            color: #94a3b8;
            text-align: center;
            padding: 0 30px;
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 0.6s ease-out 0.8s forwards;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           FULLSCREEN REQUEST SCREEN
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        #fullscreenRequestScreen {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(135deg, #0a0e1a 0%, #1a1f35 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }

        .fullscreen-request-container {
            text-align: center;
            padding: 40px 30px;
            max-width: 400px;
        }

        .fullscreen-icon {
            font-size: 72px;
            margin-bottom: 24px;
            animation: scale-pulse 2s ease-in-out infinite;
        }

        @keyframes scale-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .fullscreen-title {
            font-size: 24px;
            font-weight: bold;
            color: white;
            margin-bottom: 16px;
            letter-spacing: 0.5px;
        }

        .fullscreen-description {
            font-size: 15px;
            color: #94a3b8;
            line-height: 1.6;
            margin-bottom: 32px;
        }

        .btn-enable-fullscreen {
            width: 100%;
            padding: 16px 24px;
            background: linear-gradient(135deg, #22c55e, #16a34a);
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-bottom: 12px;
            box-shadow: 0 4px 20px rgba(34, 197, 94, 0.4);
            transition: all 0.3s;
        }

        .btn-enable-fullscreen:active {
            transform: scale(0.98);
        }

        .btn-skip-fullscreen {
            width: 100%;
            padding: 12px 24px;
            background: transparent;
            border: 1px solid rgba(148, 163, 184, 0.3);
            border-radius: 12px;
            color: #94a3b8;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           MAIN MENU STYLES
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        #mainMenu {
            min-height: 100vh;
            padding: 16px;
        }

        .profile-bar {
            display: flex;
            background: linear-gradient(135deg, #111827 0%, #0a0f18 100%);
            border: 1px solid #1e293b;
            border-radius: 18px;
            padding: 12px;
            margin-bottom: 14px;
            gap: 12px;
        }

        .profile-left {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
            min-width: 0;
        }

        .profile-avatar {
            width: 48px; height: 48px;
            border-radius: 50%;
            background: linear-gradient(135deg, #fb923c, #f97316);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            font-weight: 700;
            color: #fefce8;
            border: 2px solid #fed7aa;
            flex-shrink: 0;
        }

        .profile-info {
            display: flex;
            flex-direction: column;
            justify-content: center;
            min-width: 0;
        }

        .profile-name {
            font-size: 14px;
            font-weight: 600;
            color: #e5e7eb;
            line-height: 1.3;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .profile-handle {
            font-size: 11px;
            color: #64748b;
            line-height: 1.2;
        }

        .profile-balance {
            font-size: 18px;
            font-weight: 700;
            color: #4ade80;
            margin-top: 2px;
        }

        .profile-right {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 6px;
            flex-shrink: 0;
        }

        .profile-action-btn {
            width: 42px; height: 42px;
            border-radius: 12px;
            border: none;
            background: #1e293b;
            color: #e5e7eb;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            -webkit-tap-highlight-color: transparent;
            transition: background 0.15s, transform 0.15s;
        }

        .profile-action-btn:active {
            transform: scale(0.93);
            background: #334155;
        }

        .profile-action-btn.primary {
            background: linear-gradient(135deg, #eab308, #facc15);
            color: #111827;
        }

        /* Game Modes Grid */
        .game-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 16px;
        }

        .game-card {
            aspect-ratio: 1;
            border-radius: 20px;
            padding: 16px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            border: 2px solid transparent;
            transition: transform 0.2s, box-shadow 0.2s;
            -webkit-tap-highlight-color: transparent;
        }

        .game-card:active {
            transform: scale(0.97);
        }

        .game-card.tournament {
            background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
            border-color: #3b82f6;
            box-shadow: 0 8px 30px rgba(37, 99, 235, 0.4);
        }

        .game-card.bounty {
            background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
            border-color: #ef4444;
            box-shadow: 0 8px 30px rgba(220, 38, 38, 0.4);
        }

        .game-card.sitgo {
            background: linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%);
            border-color: #8b5cf6;
            box-shadow: 0 8px 30px rgba(124, 58, 237, 0.4);
        }

        .game-card.private {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            border-color: #fbbf24;
            box-shadow: 0 8px 30px rgba(245, 158, 11, 0.4);
        }

        .game-card-icon {
            font-size: 42px;
            margin-bottom: 8px;
        }

        .game-card-title {
            font-size: 16px;
            font-weight: 700;
            color: #fff;
            margin-bottom: 4px;
        }

        .game-card-desc {
            font-size: 11px;
            color: rgba(255,255,255,0.75);
            line-height: 1.3;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           LOBBY SCREEN STYLES
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        #lobbyScreen {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .lobby-header {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            background: #0a0f18;
            border-bottom: 1px solid #1e293b;
        }

        .back-btn {
            width: 40px; height: 40px;
            border-radius: 12px;
            border: none;
            background: #1e293b;
            color: #e5e7eb;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            -webkit-tap-highlight-color: transparent;
        }

        .back-btn:active {
            background: #334155;
        }

        .lobby-title {
            font-size: 18px;
            font-weight: 600;
            color: #e5e7eb;
        }

        .lobby-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        @media (min-width: 768px) {
            .lobby-content {
                flex-direction: row;
            }
            .lobby-tables { flex: 1; }
            .lobby-sidebar { width: 280px; }
        }

        .lobby-tables {
            flex: 1;
            padding: 16px;
            overflow-y: auto;
        }

        .lobby-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .lobby-tab {
            padding: 10px 16px;
            border-radius: 10px;
            border: none;
            background: #1e293b;
            color: #94a3b8;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            white-space: nowrap;
            -webkit-tap-highlight-color: transparent;
            transition: background 0.15s, color 0.15s;
        }

        .lobby-tab.active {
            background: #3b82f6;
            color: #fff;
        }

        .table-card {
            background: linear-gradient(135deg, #111827 0%, #0a0f18 100%);
            border: 1px solid #1e293b;
            border-radius: 14px;
            padding: 14px;
            margin-bottom: 12px;
        }

        .table-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }

        .table-name {
            font-size: 15px;
            font-weight: 600;
            color: #e5e7eb;
        }

        .table-status {
            font-size: 11px;
            padding: 4px 8px;
            border-radius: 6px;
            background: #22c55e20;
            color: #22c55e;
        }

        .table-status.waiting { background: #f59e0b20; color: #f59e0b; }
        .table-status.full { background: #ef444420; color: #ef4444; }

        .table-info {
            display: flex;
            gap: 16px;
            margin-bottom: 12px;
            font-size: 12px;
            color: #94a3b8;
        }

        .table-info span { display: flex; align-items: center; gap: 4px; }

        .join-btn {
            width: 100%;
            padding: 10px;
            border-radius: 10px;
            border: none;
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: #fff;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            -webkit-tap-highlight-color: transparent;
        }

        .join-btn:active { opacity: 0.9; }

        /* Lobby Sidebar */
        .lobby-sidebar {
            background: #0b1220;
            border-top: 1px solid #1e293b;
            padding: 16px;
        }

        @media (min-width: 768px) {
            .lobby-sidebar {
                border-top: none;
                border-left: 1px solid #1e293b;
            }
        }

        .sidebar-profile {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            padding-bottom: 16px;
            border-bottom: 1px solid #1e293b;
            margin-bottom: 16px;
        }

        .sidebar-avatar {
            width: 64px; height: 64px;
            border-radius: 50%;
            background: linear-gradient(135deg, #fb923c, #f97316);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            font-weight: 700;
            color: #fefce8;
            border: 3px solid #fed7aa;
            margin-bottom: 10px;
        }

        .sidebar-name {
            font-size: 16px;
            font-weight: 600;
            color: #e5e7eb;
        }

        .sidebar-handle {
            font-size: 12px;
            color: #64748b;
            margin-bottom: 8px;
        }

        .sidebar-balance {
            font-size: 24px;
            font-weight: 700;
            color: #4ade80;
        }

        .sidebar-buttons {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 16px;
        }

        .sidebar-btn {
            display: flex;
            align-items: center;
            gap: 10px;
            width: 100%;
            height: 44px;
            padding: 0 14px;
            border-radius: 12px;
            border: none;
            background: #1e293b;
            color: #e5e7eb;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            -webkit-tap-highlight-color: transparent;
        }

        .sidebar-btn:active { background: #334155; }

        .sidebar-btn.primary {
            background: linear-gradient(135deg, #eab308, #facc15);
            color: #111827;
        }

        .sidebar-stats {
            display: flex;
            justify-content: space-around;
            text-align: center;
        }

        .stat-value {
            font-size: 18px;
            font-weight: 600;
            color: #e5e7eb;
        }

        .stat-value.green { color: #22c55e; }

        .stat-label {
            font-size: 11px;
            color: #64748b;
        }

        /* Debug */
        .debug {
            position: fixed;
            bottom: 6px;
            left: 6px;
            right: 6px;
            font-size: 9px;
            color: #475569;
            text-align: center;
            pointer-events: none;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           POKER TABLE - PORTRAIT LAYOUT (VERTICAL)
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        #pokerTableScreen {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(180deg, #0a0e1a 0%, #1a1f35 50%, #0f1729 100%);
            overflow: hidden;
        }

        /* â•â•â•â•â•â•â• TOP HEADER BAR - COMPACT â•â•â•â•â•â•â• */
        .poker-header {
            position: fixed;
            top: 0; left: 0; right: 0;
            height: 40px;
            background: rgba(0, 0, 0, 0.45);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            display: grid;
            grid-template-columns: auto 1fr auto;
            align-items: center;
            padding: 0 8px;
            z-index: 100;
            border-bottom: 1px solid rgba(212, 175, 55, 0.15);
        }

        .table-back-btn {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: #fff;
            font-size: 11px;
            padding: 4px 8px;
            border-radius: 5px;
            cursor: pointer;
            white-space: nowrap;
        }

        .table-info {
            text-align: center;
            padding: 0 6px;
        }

        .table-info-name {
            font-size: 12px;
            font-weight: 700;
            color: #fff;
            white-space: nowrap;
        }

        .table-info-blinds {
            font-size: 9px;
            color: #22c55e;
            letter-spacing: 0.5px;
        }

        .header-spacer {
            width: 50px;
        }

        /* â•â•â•â•â•â•â• FULLSCREEN MODE â•â•â•â•â•â•â• */
        html:-webkit-full-screen,
        html:-moz-full-screen,
        html:fullscreen {
            width: 100%;
            height: 100%;
        }
        body:-webkit-full-screen,
        body:-moz-full-screen,
        body:fullscreen {
            margin: 0;
            padding: 0;
        }

        /* â•â•â•â•â•â•â• POKER TABLE - TALLER VERTICAL OVAL â•â•â•â•â•â•â• */
        .poker-table-container {
            position: absolute;
            top: 40px;
            left: 0;
            right: 0;
            bottom: 160px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 5px;
            z-index: 1 !important; /* LOW - players will be above */
        }

        .poker-table {
            position: relative;
            width: 54vw;
            height: 56vh;
            max-width: 250px;
            max-height: 480px;
            background: radial-gradient(ellipse at center, #2d5a2d 0%, #1a3a1a 60%, #0f2810 100%);
            border: 4px solid #d4af37;
            border-radius: 48% / 42%;
            box-shadow:
                0 12px 35px rgba(0, 0, 0, 0.5),
                0 0 20px rgba(212, 175, 55, 0.3),
                inset 0 0 35px rgba(0, 0, 0, 0.3);
            /* NO transform - prevents stacking context issues */
            z-index: 1 !important; /* BASE LAYER - lowest */
        }

        .table-felt {
            position: absolute;
            top: 6px; left: 6px; right: 6px; bottom: 6px;
            border: 2px solid rgba(255,255,255,0.08);
            border-radius: 48% / 42%;
        }

        /* â•â•â•â•â•â•â• POT DISPLAY - BETWEEN PLAYER AND CARDS â•â•â•â•â•â•â• */
        .pot-center {
            position: absolute !important;
            top: 28% !important;
            left: 50% !important;
            transform: translateX(-50%) scale(0.9) !important;
            background: rgba(0,0,0,0.85) !important;
            padding: 5px 14px !important;
            border-radius: 16px !important;
            border: 2px solid #fbbf24 !important;
            box-shadow: 0 3px 12px rgba(0,0,0,0.6) !important;
            z-index: 25 !important;
            text-align: center;
        }

        .pot-label {
            font-size: 7px !important;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 2px;
        }

        .pot-amount {
            font-size: 15px !important;
            font-weight: 700;
            color: #fbbf24;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }

        /* â•â•â•â•â•â•â• PLAYER SEATS - DYNAMIC â•â•â•â•â•â•â• */
        #playerSeats {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 30;
            pointer-events: none;
        }
        
        .table-player {
            position: absolute;
            display: flex;
            flex-direction: column;
            align-items: center;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 10px;
            padding: 8px;
            min-width: 80px;
            pointer-events: auto;
        }
        
        .table-player .player-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #4ade80, #22c55e);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: bold;
            color: white;
            margin-bottom: 5px;
        }
        
        .table-player .player-name {
            font-size: 11px;
            color: white;
            font-weight: 600;
            max-width: 70px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .table-player .player-chips {
            font-size: 10px;
            color: #fbbf24;
            font-weight: 500;
        }
        
        .table-player.folded {
            opacity: 0.5;
        }
        
        /* Player positions around the table - Adaptive layout */
        .table-player.position-top {
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .table-player.position-top-left {
            top: 80px;
            left: 5px;
        }
        
        .table-player.position-top-right {
            top: 80px;
            right: 5px;
        }
        
        .table-player.position-left {
            top: 45%;
            left: 5px;
            transform: translateY(-50%);
        }
        
        .table-player.position-right {
            top: 45%;
            right: 5px;
            transform: translateY(-50%);
        }
        
        .table-player.position-bottom-left {
            bottom: 240px;
            left: 5px;
        }
        
        .table-player.position-bottom-right {
            bottom: 240px;
            right: 5px;
        }
        
        /* Current turn indicator */
        .table-player.current-turn {
            box-shadow: 0 0 15px 3px #22c55e;
        }
        
        /* Player bet display */
        .table-player .player-bet {
            font-size: 10px;
            color: #fbbf24;
            font-weight: 600;
            background: rgba(251, 191, 36, 0.2);
            padding: 2px 6px;
            border-radius: 4px;
            margin-top: 3px;
        }
        
        /* Card back styling */
        .table-player .player-cards-back {
            display: flex;
            gap: 2px;
            margin-top: 5px;
        }
        
        .table-player .card-back {
            width: 24px;
            height: 34px;
            background: linear-gradient(135deg, #1e40af, #3b82f6);
            border-radius: 3px;
            border: 1px solid #60a5fa;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        /* â•â•â•â•â•â•â• COMMUNITY CARDS - CENTER (LARGER) â•â•â•â•â•â•â• */
        .community-cards {
            position: absolute;
            top: 52% !important;
            left: 50% !important;
            transform: translate(-50%, -50%) !important;
            display: flex;
            gap: 6px !important;
            z-index: 20 !important;
            padding: 0;
        }

        /* COMMUNITY CARD STYLING */
        .community-card {
            width: 46px !important;
            height: 66px !important;
            background: linear-gradient(145deg, #ffffff, #f0f0f0) !important;
            border-radius: 6px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 2px;
            font-weight: 700;
            box-shadow: 0 4px 14px rgba(0,0,0,0.5), inset 0 1px 0 rgba(255,255,255,0.8);
            border: 2px solid #374151;
            animation: cardDeal 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        
        .community-card .card-rank {
            font-size: 18px;
            font-weight: 800;
            line-height: 1;
        }
        
        .community-card .card-suit {
            font-size: 20px;
            line-height: 1;
        }
        
        .community-card.red .card-rank,
        .community-card.red .card-suit {
            color: #dc2626;
        }
        
        .community-card.black .card-rank,
        .community-card.black .card-suit {
            color: #1f2937;
        }
        
        /* Stagger animation for community cards */
        .community-card:nth-child(1) { animation-delay: 0s; }
        .community-card:nth-child(2) { animation-delay: 0.15s; }
        .community-card:nth-child(3) { animation-delay: 0.3s; }
        .community-card:nth-child(4) { animation-delay: 0.45s; }
        .community-card:nth-child(5) { animation-delay: 0.6s; }

        /* CARDS - BIGGER WITH VISIBLE SUITS + ANIMATION */
        .card {
            width: 46px !important;
            height: 66px !important;
            background: #ffffff !important;
            border-radius: 5px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 3px;
            padding: 5px !important;
            font-weight: 700;
            box-shadow: 0 4px 14px rgba(0,0,0,0.5);
            border: 2px solid #374151;
            opacity: 1 !important;
            filter: none !important;
            /* Animation - smooth card deal */
            animation: cardDeal 0.7s cubic-bezier(0.34, 1.56, 0.64, 1);
            transition: all 0.4s ease;
        }

        /* Smooth card deal animation */
        @keyframes cardDeal {
            0% {
                opacity: 0;
                transform: translateY(-50px) scale(0.3) rotateX(90deg);
            }
            40% {
                opacity: 0.6;
                transform: translateY(-15px) scale(0.85) rotateX(30deg);
            }
            70% {
                opacity: 0.9;
                transform: translateY(5px) scale(1.02) rotateX(-5deg);
            }
            100% {
                opacity: 1;
                transform: translateY(0) scale(1) rotateX(0deg);
            }
        }

        /* Stagger animation for each card - longer delays for smoother sequence */
        .card:nth-child(1) { animation-delay: 0s; }
        .card:nth-child(2) { animation-delay: 0.2s; }
        .card:nth-child(3) { animation-delay: 0.4s; }
        .card:nth-child(4) { animation-delay: 0.6s; }
        .card:nth-child(5) { animation-delay: 0.8s; }

        /* GOLDEN SHIMMER HIGHLIGHT for winning combination cards */
        .card.highlighted,
        .card.winning-card,
        .card.combo-card {
            border: 2.5px solid #fbbf24 !important;
            box-shadow: 
                0 0 12px rgba(251, 191, 36, 0.9),
                0 0 25px rgba(251, 191, 36, 0.5),
                0 4px 12px rgba(0,0,0,0.4) !important;
            animation: goldenShimmer 2s ease-in-out infinite;
        }

        /* Smooth pulsing shimmer effect */
        @keyframes goldenShimmer {
            0% {
                box-shadow: 
                    0 0 8px rgba(251, 191, 36, 0.7),
                    0 0 18px rgba(251, 191, 36, 0.3),
                    0 4px 12px rgba(0,0,0,0.4);
                border-color: #f59e0b;
            }
            25% {
                box-shadow: 
                    0 0 15px rgba(251, 191, 36, 1),
                    0 0 35px rgba(251, 191, 36, 0.6),
                    0 4px 12px rgba(0,0,0,0.4);
                border-color: #fbbf24;
            }
            50% {
                box-shadow: 
                    0 0 20px rgba(255, 215, 0, 1),
                    0 0 45px rgba(255, 215, 0, 0.7),
                    0 4px 12px rgba(0,0,0,0.4);
                border-color: #fcd34d;
            }
            75% {
                box-shadow: 
                    0 0 15px rgba(251, 191, 36, 1),
                    0 0 35px rgba(251, 191, 36, 0.6),
                    0 4px 12px rgba(0,0,0,0.4);
                border-color: #fbbf24;
            }
            100% {
                box-shadow: 
                    0 0 8px rgba(251, 191, 36, 0.7),
                    0 0 18px rgba(251, 191, 36, 0.3),
                    0 4px 12px rgba(0,0,0,0.4);
                border-color: #f59e0b;
            }
        }

        .card.red { color: #dc2626 !important; }
        .card.black { color: #1f2937 !important; }

        .card-rank { font-size: 20px !important; line-height: 1; font-weight: 800; }
        .card-suit { font-size: 20px !important; line-height: 1; }

        .card.hidden {
            background: linear-gradient(135deg, #1e40af, #1e3a8a) !important;
            color: transparent !important;
            border: 2px solid #3b82f6;
        }

        .card.hidden::after {
            content: 'ğŸ‚ ';
            font-size: 22px;
            color: #fff;
        }

        /* â•â•â•â•â•â•â• PLAYER SEATS - ON TOP OF TABLE â•â•â•â•â•â•â• */
        .player-seat {
            position: absolute;
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 50 !important; /* HIGH - above table container */
        }

        /* Seat positions - ON table edges */
        .seat-top { top: -5px !important; left: 50% !important; transform: translateX(-50%) scale(0.85) !important; z-index: 50 !important; }
        .seat-left-upper { top: 18% !important; left: -15px !important; transform: scale(0.85) !important; z-index: 50 !important; }
        .seat-left-lower { bottom: 25% !important; left: -15px !important; transform: scale(0.85) !important; z-index: 50 !important; }
        .seat-bottom { bottom: -5px !important; left: 50% !important; transform: translateX(-50%) scale(0.9) !important; z-index: 50 !important; }
        .seat-right-lower { bottom: 25% !important; right: -15px !important; transform: scale(0.85) !important; z-index: 50 !important; }
        .seat-right-upper { top: 18% !important; right: -15px !important; transform: scale(0.85) !important; z-index: 50 !important; }

        /* Legacy seat classes (for JS compatibility) */
        .seat-0 { bottom: -5px !important; left: 50% !important; transform: translateX(-50%) scale(0.9) !important; z-index: 50 !important; }
        .seat-1 { bottom: 25% !important; left: -15px !important; transform: scale(0.85) !important; z-index: 50 !important; }
        .seat-2 { top: 18% !important; left: -15px !important; transform: scale(0.85) !important; z-index: 50 !important; }
        .seat-3 { top: -5px !important; left: 50% !important; transform: translateX(-50%) scale(0.85) !important; z-index: 50 !important; }
        .seat-4 { top: 18% !important; right: -15px !important; transform: scale(0.85) !important; z-index: 50 !important; }
        .seat-5 { bottom: 25% !important; right: -15px !important; transform: scale(0.85) !important; z-index: 50 !important; }

        .player-card-container {
            background: rgba(30, 41, 59, 0.9);
            border: 2px solid rgba(212, 175, 55, 0.3);
            border-radius: 6px;
            padding: 4px 5px;
            min-width: 60px;
            max-width: 72px;
            backdrop-filter: blur(6px);
            text-align: center;
            box-shadow: 0 3px 10px rgba(0,0,0,0.4);
        }

        .player-avatar {
            width: 38px; height: 38px;
            border-radius: 50%;
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            border: 2.5px solid rgba(212, 175, 55, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 15px;
            font-weight: 700;
            color: #fff;
            margin: 0 auto 4px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.4);
            position: relative;
        }

        .player-avatar.active {
            border-color: #fbbf24;
            box-shadow: 0 0 20px rgba(251,191,36,0.6);
            animation: activePulse 1.5s infinite;
        }

        @keyframes activePulse {
            0%, 100% { box-shadow: 0 0 20px rgba(251,191,36,0.6); }
            50% { box-shadow: 0 0 30px rgba(251,191,36,0.9); }
        }

        .player-avatar.folded {
            opacity: 0.4;
            filter: grayscale(1);
        }

        .player-name {
            font-size: 9px;
            font-weight: 600;
            color: #fff;
            margin-bottom: 1px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 58px;
        }

        .player-chips {
            font-size: 10px;
            font-weight: 700;
            color: #fbbf24;
        }

        .player-cards {
            display: flex;
            gap: 2px;
            margin-top: 3px;
            justify-content: center;
        }

        .player-card {
            width: 18px; height: 26px;
            background: linear-gradient(135deg, #1e40af, #1e3a8a);
            border-radius: 2px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.4);
        }

        /* â•â•â•â•â•â•â• BOTTOM CONTROLS - NO BLUR (indicators visible) â•â•â•â•â•â•â• */
        .poker-controls-bottom {
            position: fixed !important;
            bottom: 35px !important;
            left: 0 !important;
            right: 0 !important;
            width: 100vw !important;
            background: transparent !important;
            backdrop-filter: none !important;
            -webkit-backdrop-filter: none !important;
            padding: 10px 10px 14px 10px !important;
            z-index: 100 !important;
            border-top: none !important;
            display: flex;
            flex-direction: column;
            gap: 7px;
        }

        /* Hero cards row - NO BACKGROUND */
        .hero-cards {
            display: flex;
            justify-content: center;
            gap: 10px;
            padding: 0;
            background: transparent !important;
            backdrop-filter: none !important;
            margin: 0 auto;
        }

        /* Hero cards - LARGER with strong shadows */
        .hero-card {
            width: 52px !important;
            height: 72px !important;
            background: #ffffff !important;
            border-radius: 6px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            padding: 4px 2px;
            font-weight: 700;
            box-shadow: 0 6px 20px rgba(59,130,246,0.8), 0 0 0 2px rgba(255,255,255,0.4);
            border: 2.5px solid #3b82f6;
        }

        .hero-card.red { color: #dc2626 !important; }
        .hero-card.black { color: #000000 !important; }

        .hero-card .card-rank { font-size: 22px; line-height: 1; }
        .hero-card .card-suit { font-size: 24px; line-height: 1; }

        /* GOLDEN SHIMMER for hero combo cards */
        .hero-card.combo-card {
            border: 3px solid #fbbf24 !important;
            box-shadow: 
                0 0 15px rgba(251, 191, 36, 0.9),
                0 0 30px rgba(251, 191, 36, 0.5),
                0 6px 20px rgba(0,0,0,0.4) !important;
            animation: heroGoldenShimmer 2s ease-in-out infinite;
        }

        /* Smooth pulsing shimmer for hero cards */
        @keyframes heroGoldenShimmer {
            0% {
                box-shadow: 
                    0 0 10px rgba(251, 191, 36, 0.7),
                    0 0 22px rgba(251, 191, 36, 0.4),
                    0 6px 20px rgba(0,0,0,0.4);
                border-color: #f59e0b;
            }
            25% {
                box-shadow: 
                    0 0 18px rgba(251, 191, 36, 1),
                    0 0 40px rgba(251, 191, 36, 0.6),
                    0 6px 20px rgba(0,0,0,0.4);
                border-color: #fbbf24;
            }
            50% {
                box-shadow: 
                    0 0 25px rgba(255, 215, 0, 1),
                    0 0 55px rgba(255, 215, 0, 0.7),
                    0 6px 20px rgba(0,0,0,0.4);
                border-color: #fcd34d;
            }
            75% {
                box-shadow: 
                    0 0 18px rgba(251, 191, 36, 1),
                    0 0 40px rgba(251, 191, 36, 0.6),
                    0 6px 20px rgba(0,0,0,0.4);
                border-color: #fbbf24;
            }
            100% {
                box-shadow: 
                    0 0 10px rgba(251, 191, 36, 0.7),
                    0 0 22px rgba(251, 191, 36, 0.4),
                    0 6px 20px rgba(0,0,0,0.4);
                border-color: #f59e0b;
            }
        }

        /* Action buttons grid */
        .action-buttons-row {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 4px;
            padding: 0;
        }

        .betting-controls.disabled {
            opacity: 0.5;
            pointer-events: none;
        }

        .controls-row {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .phase-indicator {
            background: rgba(255, 255, 255, 0.1);
            padding: 5px 12px;
            border-radius: 16px;
            font-size: 10px;
            font-weight: 700;
            letter-spacing: 1px;
            text-transform: uppercase;
            color: #fbbf24;
            border: 1px solid rgba(251, 191, 36, 0.3);
            white-space: nowrap;
        }

        .action-buttons {
            display: flex;
            gap: 6px;
            flex: 1;
        }

        .action-btn {
            height: 44px;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.15);
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            cursor: pointer;
            color: white;
            transition: all 0.15s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            text-shadow: 0 1px 3px rgba(0,0,0,0.5);
            padding: 0 4px;
            white-space: nowrap;
            box-shadow: 0 4px 14px rgba(0,0,0,0.5);
        }

        .action-btn:active {
            transform: scale(0.95);
        }

        .action-btn.fold {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
            box-shadow: 0 4px 12px rgba(220, 38, 38, 0.5);
        }

        .action-btn.call, .action-btn.check {
            background: linear-gradient(135deg, #22c55e, #16a34a);
            box-shadow: 0 4px 12px rgba(34, 197, 94, 0.5);
        }

        .action-btn.raise {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.5);
        }

        .action-btn.allin {
            background: linear-gradient(135deg, #a855f7, #9333ea);
            box-shadow: 0 4px 12px rgba(168, 85, 247, 0.5);
        }

        .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        /* â•â•â•â•â•â•â• GAME PHASE INDICATOR - RIGHT SIDE (ABOVE USER CARDS) â•â•â•â•â•â•â• */
        .game-phase-indicator {
            position: fixed !important;
            bottom: 200px !important;
            right: 10px !important;
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.95), rgba(22, 163, 74, 0.95));
            padding: 6px 12px !important;
            border-radius: 8px !important;
            font-size: 10px !important;
            font-weight: 700;
            color: white;
            letter-spacing: 0.5px;
            box-shadow: 0 4px 14px rgba(34, 197, 94, 0.7) !important;
            z-index: 90 !important;
        }

        .game-phase-indicator.flop {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.95), rgba(37, 99, 235, 0.95));
            box-shadow: 0 4px 14px rgba(59, 130, 246, 0.7) !important;
        }
        .game-phase-indicator.turn {
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.95), rgba(245, 158, 11, 0.95));
            box-shadow: 0 4px 14px rgba(251, 191, 36, 0.7) !important;
        }
        .game-phase-indicator.river {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.95), rgba(220, 38, 38, 0.95));
            box-shadow: 0 4px 14px rgba(239, 68, 68, 0.7) !important;
        }

        /* Bet Slider Row */
        .slider-row {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .bet-amount-display {
            min-width: 50px;
            text-align: center;
            font-size: 13px;
            font-weight: 700;
            color: #fbbf24;
            text-shadow: 0 2px 6px rgba(0,0,0,0.7), 0 0 8px rgba(251,191,36,0.3);
        }

        .bet-slider {
            flex: 1;
            height: 3px;
            -webkit-appearance: none;
            appearance: none;
            background: linear-gradient(to right, #22c55e, #fbbf24, #ef4444);
            border-radius: 2px;
            outline: none;
        }

        .bet-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 18px;
            border-radius: 50%;
            background: #fff;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.5);
        }

        .quick-bets {
            display: flex;
            gap: 4px;
        }

        .quick-bet-btn {
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.25);
            color: #fff;
            border-radius: 5px;
            padding: 4px 8px;
            font-size: 10px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.15s;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
        }

        .quick-bet-btn:hover, .quick-bet-btn.active {
            background: #4a6bff;
            border-color: #4a6bff;
        }

        /* â•â•â•â•â•â•â• CARD FLIP ANIMATION â•â•â•â•â•â•â• */
        .card-container {
            perspective: 1000px;
            display: inline-block;
        }

        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
            transition: transform 0.6s;
        }

        .card-inner.flipped {
            transform: rotateY(180deg);
        }

        .card-inner.animating {
            animation: flipReveal 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        @keyframes flipReveal {
            0% { transform: rotateY(180deg); opacity: 0.8; }
            50% { transform: rotateY(90deg); opacity: 1; }
            100% { transform: rotateY(0deg); opacity: 1; }
        }

        .card-face {
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
        }

        .card-face.back {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            transform: rotateY(180deg);
            background: linear-gradient(135deg, #1e40af, #1e3a8a);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .card-face.back::before {
            content: 'ğŸ°';
            font-size: 20px;
        }

        .card-face.front {
            background: #fff;
            border-radius: 8px;
        }

        .card.highlighted {
            box-shadow: 0 0 20px 5px rgba(34, 197, 94, 0.8) !important;
            transform: translateY(-5px);
        }

        /* â•â•â•â•â•â•â• HAND STRENGTH HUD - LEFT SIDE (ABOVE USER CARDS) â•â•â•â•â•â•â• */
        .hand-hud {
            position: fixed !important;
            bottom: 200px !important;
            left: 10px !important;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.95), rgba(37, 99, 235, 0.95));
            border-radius: 8px !important;
            padding: 8px 10px !important;
            display: flex;
            flex-direction: column;
            gap: 2px;
            box-shadow: 0 4px 14px rgba(59, 130, 246, 0.7) !important;
            backdrop-filter: none !important;
            z-index: 90 !important;
            animation: slideInLeft 0.3s ease-out;
            max-width: 90px;
        }

        .hand-hud.hidden { display: none; }

        @keyframes slideInLeft {
            from { transform: translateX(-80px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .hand-hud-icon { font-size: 14px; text-align: center; }
        .hand-hud-rank {
            font-size: 10px;
            font-weight: 700;
            color: white;
            text-transform: uppercase;
            text-align: center;
        }
        .hand-hud-desc {
            font-size: 8px;
            color: rgba(255,255,255,0.85);
            text-align: center;
        }

        /* Rarity colors */
        .hand-hud.legendary { background: linear-gradient(135deg, rgba(255,140,0,0.95), rgba(245,158,11,0.95)); }
        .hand-hud.epic { background: linear-gradient(135deg, rgba(168,85,247,0.95), rgba(147,51,234,0.95)); }
        .hand-hud.rare { background: linear-gradient(135deg, rgba(59,130,246,0.95), rgba(37,99,235,0.95)); }

        /* â•â•â•â•â•â•â• SHOW/MUCK MODAL â•â•â•â•â•â•â• */
        .showmuck-modal {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 400;
            backdrop-filter: blur(8px);
        }

        .showmuck-modal.hidden { display: none; }

        .showmuck-content {
            background: linear-gradient(135deg, #1e293b, #0f172a);
            border: 2px solid #334155;
            border-radius: 20px;
            padding: 28px;
            max-width: 340px;
            text-align: center;
        }

        .showmuck-content h3 {
            font-size: 22px;
            margin-bottom: 8px;
            color: #fff;
        }

        .showmuck-content p {
            color: #94a3b8;
            margin-bottom: 20px;
            font-size: 14px;
        }

        .showmuck-cards {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-bottom: 20px;
        }

        .showmuck-buttons {
            display: flex;
            gap: 12px;
        }

        .showmuck-buttons button {
            flex: 1;
            padding: 14px;
            border-radius: 12px;
            border: none;
            font-size: 15px;
            font-weight: 700;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }

        .btn-show {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: #fff;
        }

        .btn-muck {
            background: linear-gradient(135deg, #64748b, #475569);
            color: #fff;
        }

        .btn-hint {
            font-size: 10px;
            font-weight: 400;
            opacity: 0.8;
        }

        /* Winner Popup */
        .winner-popup {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.85);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 300;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .winner-badge {
            background: linear-gradient(145deg, #1a1a2e, #16213e);
            border: 3px solid #fbbf24;
            border-radius: 20px;
            padding: 30px 50px;
            text-align: center;
            box-shadow: 0 0 60px rgba(251,191,36,0.4);
            animation: scaleIn 0.4s ease;
        }

        @keyframes scaleIn {
            from { transform: scale(0.5); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .winner-icon {
            font-size: 60px;
            margin-bottom: 10px;
        }

        .winner-name {
            font-size: 24px;
            font-weight: 700;
            color: #fbbf24;
            margin-bottom: 8px;
        }

        .winner-hand {
            font-size: 18px;
            color: #a3e635;
            margin-bottom: 12px;
        }

        .winner-amount {
            font-size: 28px;
            font-weight: 700;
            color: #4ade80;
        }

        /* Player Timer */
        .player-timer {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #fbbf24;
            color: #000;
            font-size: 10px;
            font-weight: 700;
            padding: 2px 6px;
            border-radius: 10px;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* Player Bet */
        .player-bet {
            font-size: 10px;
            color: #fbbf24;
            font-weight: 600;
            margin-top: 2px;
        }

        /* Disabled buttons */
        .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Device-specific styles */
        .device-mobile .poker-table {
            width: 90%;
            max-width: none;
        }

        .device-mobile .action-btn {
            padding: 10px 16px;
            font-size: 13px;
        }

        .device-desktop .poker-table {
            width: 70%;
            max-width: 500px;
        }

        .device-desktop .action-btn {
            padding: 14px 28px;
            font-size: 16px;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           PRIVATE GAME MODAL STYLES
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .private-game-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .private-game-content {
            background: linear-gradient(145deg, #1e293b, #0f172a);
            border-radius: 20px;
            padding: 24px;
            width: 100%;
            max-width: 380px;
            border: 2px solid rgba(251, 191, 36, 0.3);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .private-game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .private-game-title {
            font-size: 22px;
            font-weight: 700;
            color: #fbbf24;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .private-game-close {
            background: rgba(239, 68, 68, 0.2);
            border: none;
            color: #ef4444;
            font-size: 24px;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.2s;
        }

        .private-game-close:hover {
            background: rgba(239, 68, 68, 0.4);
        }

        .private-game-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
        }

        .pg-tab {
            flex: 1;
            padding: 12px;
            background: rgba(30, 41, 59, 0.8);
            border: 2px solid transparent;
            border-radius: 12px;
            color: #94a3b8;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .pg-tab.active {
            background: rgba(251, 191, 36, 0.15);
            border-color: #fbbf24;
            color: #fbbf24;
        }

        .pg-tab:hover:not(.active) {
            background: rgba(59, 130, 246, 0.2);
        }

        /* Create Lobby Form */
        .create-lobby-form {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .form-label {
            color: #94a3b8;
            font-size: 13px;
            font-weight: 600;
        }

        .form-select, .form-input {
            background: rgba(15, 23, 42, 0.8);
            border: 2px solid rgba(59, 130, 246, 0.3);
            border-radius: 10px;
            padding: 12px 14px;
            color: #fff;
            font-size: 15px;
            outline: none;
            transition: all 0.2s;
        }

        .form-select:focus, .form-input:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.3);
        }

        .form-select option {
            background: #1e293b;
            color: #fff;
        }

        .blinds-row {
            display: flex;
            gap: 10px;
        }

        .blinds-row .form-group {
            flex: 1;
        }

        .create-btn {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            border: none;
            border-radius: 12px;
            padding: 14px;
            color: #000;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            margin-top: 10px;
            transition: all 0.2s;
        }

        .create-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(251, 191, 36, 0.4);
        }

        /* Join Lobby Form */
        .join-lobby-form {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .lobby-code-input {
            background: rgba(15, 23, 42, 0.8);
            border: 2px solid rgba(59, 130, 246, 0.3);
            border-radius: 12px;
            padding: 16px;
            color: #fff;
            font-size: 24px;
            font-weight: 700;
            text-align: center;
            letter-spacing: 8px;
            text-transform: uppercase;
        }

        .join-btn {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            border: none;
            border-radius: 12px;
            padding: 14px;
            color: #fff;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
        }

        .join-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
        }

        /* Lobby Created Screen */
        .lobby-created {
            text-align: center;
        }

        .lobby-code-display {
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.2), rgba(245, 158, 11, 0.1));
            border: 2px solid #fbbf24;
            border-radius: 16px;
            padding: 20px;
            margin: 16px 0;
        }

        .lobby-code-label {
            color: #94a3b8;
            font-size: 13px;
            margin-bottom: 8px;
        }

        .lobby-code-value {
            font-size: 36px;
            font-weight: 800;
            color: #fbbf24;
            letter-spacing: 10px;
        }

        .lobby-settings-summary {
            background: rgba(15, 23, 42, 0.6);
            border-radius: 12px;
            padding: 14px;
            margin: 16px 0;
        }

        .settings-row {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            border-bottom: 1px solid rgba(148, 163, 184, 0.1);
        }

        .settings-row:last-child {
            border-bottom: none;
        }

        .settings-label {
            color: #94a3b8;
            font-size: 13px;
        }

        .settings-value {
            color: #fff;
            font-size: 13px;
            font-weight: 600;
        }

        .invite-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 16px;
        }

        .invite-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 14px;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
        }

        .invite-btn.telegram {
            background: linear-gradient(135deg, #0088cc, #0077b5);
            color: #fff;
        }

        .invite-btn.telegram:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 136, 204, 0.4);
        }

        .invite-btn.copy {
            background: rgba(59, 130, 246, 0.2);
            border: 2px solid #3b82f6;
            color: #3b82f6;
        }

        .invite-btn.copy:hover {
            background: rgba(59, 130, 246, 0.3);
        }

        .start-game-btn {
            background: linear-gradient(135deg, #22c55e, #16a34a);
            border: none;
            border-radius: 12px;
            padding: 14px;
            color: #fff;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            margin-top: 10px;
            transition: all 0.2s;
        }

        .start-game-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(34, 197, 94, 0.4);
        }

        .waiting-players {
            background: rgba(15, 23, 42, 0.6);
            border-radius: 12px;
            padding: 14px;
            margin: 16px 0;
        }

        .waiting-title {
            color: #94a3b8;
            font-size: 13px;
            margin-bottom: 10px;
        }

        .players-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .player-chip {
            background: rgba(59, 130, 246, 0.2);
            border: 1px solid rgba(59, 130, 246, 0.4);
            border-radius: 20px;
            padding: 6px 12px;
            font-size: 13px;
            color: #60a5fa;
        }

        .player-chip.host {
            background: rgba(251, 191, 36, 0.2);
            border-color: rgba(251, 191, 36, 0.4);
            color: #fbbf24;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           PRIVATE LOBBY WAITING ROOM
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        #waitingRoomScreen {
            min-height: 100vh;
            background: linear-gradient(180deg, #0f172a 0%, #1e293b 100%);
            display: flex;
            flex-direction: column;
            padding: 20px;
        }

        .waiting-room-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 24px;
        }

        .waiting-room-back {
            background: rgba(239, 68, 68, 0.2);
            border: none;
            color: #ef4444;
            font-size: 20px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
        }

        .waiting-room-title {
            font-size: 20px;
            font-weight: 700;
            color: #fbbf24;
        }

        .waiting-room-code {
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.2), rgba(245, 158, 11, 0.1));
            border: 2px solid #fbbf24;
            border-radius: 16px;
            padding: 16px;
            text-align: center;
            margin-bottom: 20px;
        }

        .waiting-code-label {
            color: #94a3b8;
            font-size: 12px;
            margin-bottom: 6px;
        }

        .waiting-code-value {
            font-size: 32px;
            font-weight: 800;
            color: #fbbf24;
            letter-spacing: 8px;
        }

        .waiting-room-info {
            background: rgba(15, 23, 42, 0.6);
            border-radius: 12px;
            padding: 14px;
            margin-bottom: 20px;
        }

        .waiting-info-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(148, 163, 184, 0.1);
        }

        .waiting-info-row:last-child {
            border-bottom: none;
        }

        .waiting-info-label {
            color: #94a3b8;
            font-size: 14px;
        }

        .waiting-info-value {
            color: #fff;
            font-size: 14px;
            font-weight: 600;
        }

        .waiting-players-section {
            flex: 1;
            background: rgba(15, 23, 42, 0.4);
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .waiting-players-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .waiting-players-title {
            color: #fff;
            font-size: 16px;
            font-weight: 600;
        }

        .waiting-players-count {
            background: rgba(59, 130, 246, 0.2);
            color: #60a5fa;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
        }

        .waiting-players-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        .waiting-player-slot {
            background: rgba(30, 41, 59, 0.8);
            border: 2px dashed rgba(148, 163, 184, 0.3);
            border-radius: 12px;
            padding: 16px;
            text-align: center;
            min-height: 80px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .waiting-player-slot.occupied {
            border: 2px solid rgba(34, 197, 94, 0.5);
            background: rgba(34, 197, 94, 0.1);
        }

        .waiting-player-slot.host {
            border: 2px solid rgba(251, 191, 36, 0.5);
            background: rgba(251, 191, 36, 0.1);
        }

        .waiting-player-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: 700;
            color: #fff;
            margin-bottom: 6px;
        }

        .waiting-player-slot.host .waiting-player-avatar {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            color: #000;
        }

        .waiting-player-name {
            color: #fff;
            font-size: 12px;
            font-weight: 600;
        }

        .waiting-player-slot.empty .waiting-player-avatar {
            background: rgba(148, 163, 184, 0.2);
            color: #64748b;
        }

        .waiting-player-slot.empty .waiting-player-name {
            color: #64748b;
        }

        .waiting-room-actions {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .waiting-invite-btn {
            background: linear-gradient(135deg, #0088cc, #0077b5);
            border: none;
            border-radius: 12px;
            padding: 14px;
            color: #fff;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .waiting-start-btn {
            background: linear-gradient(135deg, #22c55e, #16a34a);
            border: none;
            border-radius: 12px;
            padding: 14px;
            color: #fff;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
        }

        .waiting-start-btn:disabled {
            background: rgba(148, 163, 184, 0.3);
            color: #64748b;
            cursor: not-allowed;
        }

        .waiting-status {
            text-align: center;
            color: #94a3b8;
            font-size: 14px;
            margin-top: 10px;
        }

        .waiting-status.ready {
            color: #22c55e;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .waiting-dot {
            animation: pulse 1.5s infinite;
        }
    </style>
</head>
<body>
    <!-- CRITICAL: Initial loader - shows immediately while JS loads -->
    <div id="initialLoader" class="initial-loader">
        <div class="loader-spinner"></div>
        <div class="loader-text">ğŸ° Loading Poker House...</div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         SCREEN 0: FULLSCREEN REQUEST (shows first on mobile)
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div id="fullscreenRequestScreen" class="hidden">
        <div class="fullscreen-request-container">
            <div class="fullscreen-icon">ğŸ“±â¡ï¸ğŸ–¥ï¸</div>
            <h2 class="fullscreen-title">Ğ›ÑƒÑ‡ÑˆĞ¸Ğ¹ Ğ¾Ğ¿Ñ‹Ñ‚ Ğ¸Ğ³Ñ€Ñ‹</h2>
            <p class="fullscreen-description">
                Ğ”Ğ»Ñ ĞºĞ¾Ğ¼Ñ„Ğ¾Ñ€Ñ‚Ğ½Ğ¾Ğ¹ Ğ¸Ğ³Ñ€Ñ‹ Ğ² Ğ¿Ğ¾ĞºĞµÑ€ Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµĞ¼<br>
                Ñ€Ğ°Ğ·Ğ²ĞµÑ€Ğ½ÑƒÑ‚ÑŒ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ Ğ½Ğ° Ğ²ĞµÑÑŒ ÑĞºÑ€Ğ°Ğ½
            </p>
            <button class="btn-enable-fullscreen" onclick="enableFullscreenAndContinue()">
                ğŸ® Ğ’ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ğ»Ğ½Ğ¾ÑĞºÑ€Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ñ€ĞµĞ¶Ğ¸Ğ¼
            </button>
            <button class="btn-skip-fullscreen" onclick="skipFullscreenAndContinue()">
                ĞŸÑ€Ğ¾Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ
            </button>
        </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         SCREEN 1: SPLASH SCREEN
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div id="splashScreen">
        <div class="splash-bg-glow"></div>
        <h1 class="splash-title">ğŸ° Poker House</h1>
        <div class="splash-cowboy">
            ğŸ¤ <span class="splash-wave">ğŸ‘‹</span>
        </div>
        <p class="splash-phrase" id="splashPhrase"></p>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         SCREEN 2: MAIN MENU
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div id="mainMenu" class="hidden">
        <!-- Profile Bar: Avatar+Info | 2x2 Buttons -->
        <div class="profile-bar">
            <div class="profile-left">
                <div class="profile-avatar" id="menuAvatar">P</div>
                <div class="profile-info">
                    <div class="profile-name" id="menuName">Player</div>
                    <div class="profile-handle" id="menuHandle"></div>
                    <div class="profile-balance" id="menuBalance">$1,000</div>
                </div>
            </div>
            <div class="profile-right">
                <button class="profile-action-btn primary" onclick="handleDeposit()" title="Deposit">ğŸ’³</button>
                <button class="profile-action-btn" onclick="handleWithdraw()" title="Withdraw">ğŸ’°</button>
                <button class="profile-action-btn" onclick="handleHistory()" title="History">ğŸ“‹</button>
                <button class="profile-action-btn" onclick="handleSettings()" title="Settings">âš™ï¸</button>
            </div>
        </div>

        <!-- Game Modes Grid 2x2 -->
        <div class="game-grid">
            <div class="game-card tournament" onclick="openLobby('tournament')">
                <div class="game-card-icon">ğŸ†</div>
                <div class="game-card-title">Tournament</div>
                <div class="game-card-desc">Multi-table poker for big prizes</div>
            </div>
            <div class="game-card bounty" onclick="openLobby('bounty')">
                <div class="game-card-icon">ğŸ¯</div>
                <div class="game-card-title">Bounty Hunter</div>
                <div class="game-card-desc">Knockout rewards for eliminations</div>
            </div>
            <div class="game-card sitgo" onclick="openLobby('sitgo')">
                <div class="game-card-icon">âš¡</div>
                <div class="game-card-title">Sit & Go</div>
                <div class="game-card-desc">Fast single-table tournaments</div>
            </div>
            <div class="game-card private" onclick="openLobby('private')">
                <div class="game-card-icon">ğŸ°</div>
                <div class="game-card-title">Private Game</div>
                <div class="game-card-desc">Create or join private tables</div>
            </div>
        </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         SCREEN 3: GAME LOBBY
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div id="lobbyScreen" class="hidden">
        <div class="lobby-header">
            <button class="back-btn" onclick="goBack()">â†</button>
            <h2 class="lobby-title" id="lobbyTitle">Tournament Lobby</h2>
        </div>

        <div class="lobby-content">
            <!-- Left: Tables List -->
            <div class="lobby-tables">
                <div class="lobby-tabs">
                    <button class="lobby-tab active" onclick="switchTab(this, 'all')">All Tables</button>
                    <button class="lobby-tab" onclick="switchTab(this, 'low')">Low Stakes</button>
                    <button class="lobby-tab" onclick="switchTab(this, 'mid')">Mid Stakes</button>
                    <button class="lobby-tab" onclick="switchTab(this, 'high')">High Stakes</button>
                </div>

                <div id="tablesList">
                    <!-- Tables will be rendered here -->
                </div>
            </div>

            <!-- Right: Player Sidebar -->
            <div class="lobby-sidebar">
                <div class="sidebar-profile">
                    <div class="sidebar-avatar" id="lobbyAvatar">P</div>
                    <div class="sidebar-name" id="lobbyName">Player</div>
                    <div class="sidebar-handle" id="lobbyHandle"></div>
                    <div class="sidebar-balance" id="lobbyBalance">$1,000</div>
                </div>

                <div class="sidebar-buttons">
                    <button class="sidebar-btn primary" onclick="handleDeposit()">
                        <span>ğŸ’³</span><span>Deposit</span>
                    </button>
                    <button class="sidebar-btn" onclick="handleWithdraw()">
                        <span>ğŸ’°</span><span>Withdraw</span>
                    </button>
                    <button class="sidebar-btn" onclick="handleHistory()">
                        <span>ğŸ“‹</span><span>History</span>
                    </button>
                    <button class="sidebar-btn" onclick="handleSettings()">
                        <span>âš™ï¸</span><span>Settings</span>
                    </button>
                </div>

                <div class="sidebar-stats">
                    <div>
                        <div class="stat-value">24</div>
                        <div class="stat-label">Games</div>
                    </div>
                    <div>
                        <div class="stat-value green">58%</div>
                        <div class="stat-label">Win Rate</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         PRIVATE GAME MODAL
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div id="privateGameModal" class="private-game-modal hidden">
        <div class="private-game-content">
            <div class="private-game-header">
                <div class="private-game-title">ğŸ° Private Game</div>
                <button class="private-game-close" onclick="closePrivateGameModal(true)">Ã—</button>
            </div>

            <!-- Tabs: Create / Join -->
            <div class="private-game-tabs">
                <button class="pg-tab active" onclick="switchPrivateTab('create', this)">Create Lobby</button>
                <button class="pg-tab" onclick="switchPrivateTab('join', this)">Join Lobby</button>
            </div>

            <!-- Create Lobby Form -->
            <div id="createLobbyView">
                <div class="create-lobby-form">
                    <div class="form-group">
                        <label class="form-label">Buy-in Amount</label>
                        <select class="form-select" id="buyInSelect">
                            <option value="100">$100</option>
                            <option value="500">$500</option>
                            <option value="1000" selected>$1,000</option>
                            <option value="5000">$5,000</option>
                            <option value="10000">$10,000</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Max Players</label>
                        <select class="form-select" id="maxPlayersSelect">
                            <option value="2">2 Players (Heads-up)</option>
                            <option value="4">4 Players</option>
                            <option value="6" selected>6 Players</option>
                            <option value="9">9 Players</option>
                        </select>
                    </div>

                    <div class="blinds-row">
                        <div class="form-group">
                            <label class="form-label">Small Blind</label>
                            <select class="form-select" id="smallBlindSelect">
                                <option value="5">$5</option>
                                <option value="10" selected>$10</option>
                                <option value="25">$25</option>
                                <option value="50">$50</option>
                                <option value="100">$100</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Big Blind</label>
                            <select class="form-select" id="bigBlindSelect">
                                <option value="10">$10</option>
                                <option value="20" selected>$20</option>
                                <option value="50">$50</option>
                                <option value="100">$100</option>
                                <option value="200">$200</option>
                            </select>
                        </div>
                    </div>

                    <button class="create-btn" onclick="createPrivateLobby()">ğŸ¯ Create Lobby</button>
                </div>
            </div>

            <!-- Join Lobby Form -->
            <div id="joinLobbyView" class="hidden">
                <div class="join-lobby-form">
                    <div class="form-group">
                        <label class="form-label">Enter Lobby Code</label>
                        <input type="text" class="lobby-code-input" id="lobbyCodeInput" maxlength="6" placeholder="XXXXXX">
                    </div>
                    <button class="join-btn" onclick="joinPrivateLobby()">ğŸš€ Join Lobby</button>
                </div>
            </div>

            <!-- Lobby Created View -->
            <div id="lobbyCreatedView" class="hidden">
                <div class="lobby-created">
                    <div class="lobby-code-display">
                        <div class="lobby-code-label">Your Lobby Code</div>
                        <div class="lobby-code-value" id="createdLobbyCode">ABC123</div>
                    </div>

                    <div class="lobby-settings-summary">
                        <div class="settings-row">
                            <span class="settings-label">Buy-in</span>
                            <span class="settings-value" id="summaryBuyIn">$1,000</span>
                        </div>
                        <div class="settings-row">
                            <span class="settings-label">Blinds</span>
                            <span class="settings-value" id="summaryBlinds">$10/$20</span>
                        </div>
                        <div class="settings-row">
                            <span class="settings-label">Max Players</span>
                            <span class="settings-value" id="summaryPlayers">6</span>
                        </div>
                    </div>

                    <div class="waiting-players">
                        <div class="waiting-title">Players in Lobby (1/<span id="maxPlayersCount">6</span>)</div>
                        <div class="players-list" id="lobbyPlayersList">
                            <span class="player-chip host" id="hostChip">ğŸ‘‘ You (Host)</span>
                        </div>
                    </div>

                    <div class="invite-buttons">
                        <button class="invite-btn telegram" onclick="inviteViaTelegram()">
                            <span>ğŸ“¨</span> Invite via Telegram
                        </button>
                        <button class="invite-btn copy" onclick="copyLobbyLink()">
                            <span>ğŸ“‹</span> Copy Invite Link
                        </button>
                    </div>

                    <button class="start-game-btn" onclick="goToWaitingRoom()">â–¶ï¸ Start Game</button>
                </div>
            </div>
        </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         SCREEN: WAITING ROOM FOR PRIVATE LOBBY
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div id="waitingRoomScreen" class="hidden">
        <div class="waiting-room-header">
            <button class="waiting-room-back" onclick="leaveWaitingRoom()">â†</button>
            <div class="waiting-room-title">ğŸ° Private Lobby</div>
        </div>

        <div class="waiting-room-code">
            <div class="waiting-code-label">Lobby Code</div>
            <div class="waiting-code-value" id="waitingLobbyCode">XXXXXX</div>
        </div>

        <div class="waiting-room-info">
            <div class="waiting-info-row">
                <span class="waiting-info-label">Buy-in</span>
                <span class="waiting-info-value" id="waitingBuyIn">$1,000</span>
            </div>
            <div class="waiting-info-row">
                <span class="waiting-info-label">Blinds</span>
                <span class="waiting-info-value" id="waitingBlinds">$10/$20</span>
            </div>
            <div class="waiting-info-row">
                <span class="waiting-info-label">Max Players</span>
                <span class="waiting-info-value" id="waitingMaxPlayers">6</span>
            </div>
        </div>

        <div class="waiting-players-section">
            <div class="waiting-players-header">
                <span class="waiting-players-title">Players</span>
                <span class="waiting-players-count" id="waitingPlayersCount">1/6</span>
            </div>
            <div class="waiting-players-grid" id="waitingPlayersGrid">
                <!-- Players rendered dynamically -->
            </div>
        </div>

        <div class="waiting-room-actions">
            <button class="waiting-invite-btn" onclick="inviteViaTelegram()">
                <span>ğŸ“¨</span> Invite Friends via Telegram
            </button>
            <button class="waiting-start-btn" id="waitingStartBtn" onclick="startGameFromWaitingRoom()">
                â–¶ï¸ Start Game
            </button>
            <div class="waiting-status" id="waitingStatus">
                <span class="waiting-dot">â³</span> Waiting for players to join...
            </div>
        </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         SCREEN 4: POKER TABLE (PORTRAIT LAYOUT)
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div id="pokerTableScreen" class="hidden">
        <!-- Top Header Bar -->
        <div class="poker-header">
            <button class="table-back-btn" onclick="leaveTable()">â† Menu</button>
            <div class="table-info">
                <div class="table-info-name" id="tableInfoName">Daily Freeroll</div>
                <div class="table-info-blinds" id="tableInfoBlinds">PRE-FLOP</div>
            </div>
            <div class="header-spacer"></div>
        </div>

        <!-- Table Container (centers the vertical oval) -->
        <div class="poker-table-container">
            <div class="poker-table">
                <div class="table-felt"></div>
                
                <!-- POT Display -->
                <div class="pot-center">
                    <div class="pot-label">POT</div>
                    <div class="pot-amount" id="potAmount">$0</div>
                </div>
                
                <!-- Community Cards -->
                <div class="community-cards" id="communityCards">
                    <!-- Cards rendered here -->
                </div>

                <!-- Player Seats (6-max portrait layout) -->
                <div id="playerSeats">
                    <!-- Players rendered dynamically -->
                </div>
            </div>
        </div>

        <!-- Game Phase Indicator (right side) -->
        <div class="game-phase-indicator" id="gamePhaseIndicator">PRE-FLOP</div>
        
        <!-- Hand Strength HUD (left side) -->
        <div class="hand-hud hidden" id="handHud">
            <div class="hand-hud-icon" id="handIcon">ğŸƒ</div>
            <div class="hand-hud-rank" id="handRank">High Card</div>
            <div class="hand-hud-desc" id="handDesc">Ace high</div>
        </div>

        <!-- Bottom Controls Panel -->
        <div class="poker-controls-bottom">
            <!-- Hero Cards -->
            <div class="hero-cards" id="heroCards">
                <div class="hero-card red">
                    <span class="card-rank">A</span>
                    <span class="card-suit">â™¥</span>
                </div>
                <div class="hero-card black">
                    <span class="card-rank">K</span>
                    <span class="card-suit">â™ </span>
                </div>
            </div>
            
            <!-- Action Buttons Row -->
            <div class="action-buttons-row" id="actionButtons">
                <button class="action-btn fold" onclick="playerAction('fold')">Fold</button>
                <button class="action-btn call" onclick="playerAction('call')" id="callBtn">Check</button>
                <button class="action-btn raise" onclick="playerAction('raise')" id="raiseBtn">Bet</button>
                <button class="action-btn allin" onclick="playerAction('allin')">All In</button>
            </div>
            
            <!-- Bet Slider Row -->
            <div class="slider-row">
                <div class="bet-amount-display" id="betDisplay">$20</div>
                <input type="range" class="bet-slider" id="betSlider" min="20" max="1000" value="20" oninput="updateBetSlider(this.value)">
                <div class="quick-bets">
                    <button class="quick-bet-btn" onclick="quickBet(2)">2x</button>
                    <button class="quick-bet-btn" onclick="quickBet(3)">3x</button>
                    <button class="quick-bet-btn" onclick="quickBet(0)">MAX</button>
                </div>
            </div>
        </div>
        
        <!-- Show/Muck Modal -->
        <div class="showmuck-modal hidden" id="showmuckModal">
            <div class="showmuck-content">
                <h3>Show Your Cards?</h3>
                <p>You folded. Reveal your hand to the table?</p>
                <div class="showmuck-cards" id="showmuckCards">
                    <!-- Cards displayed here -->
                </div>
                <div class="showmuck-buttons">
                    <button class="btn-show" onclick="showCards()">
                        ğŸ‘ï¸ SHOW
                        <span class="btn-hint">Reveal to table</span>
                    </button>
                    <button class="btn-muck" onclick="muckCards()">
                        ğŸ”’ MUCK
                        <span class="btn-hint">Keep hidden</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="debugInfo" class="debug"></div>

    <script>
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // DEBUG & INITIALIZATION
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        var debugLog = [];
        function addDebug(msg) {
            debugLog.push(msg);
            var el = document.getElementById('debugInfo');
            if (el) el.textContent = debugLog.slice(-3).join(' â†’ ');
            console.log('[mobile] ' + msg);
        }

        addDebug('Init');
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // SMOOTH SCREEN TRANSITIONS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function showScreen(screenId, hideScreens) {
            hideScreens = hideScreens || [];
            
            // Hide specified screens with animation
            hideScreens.forEach(function(id) {
                var el = document.getElementById(id);
                if (el && !el.classList.contains('hidden')) {
                    el.classList.add('screen-fade-out');
                    setTimeout(function() {
                        el.classList.add('hidden');
                        el.classList.remove('screen-fade-out');
                    }, 300);
                }
            });
            
            // Show new screen with animation
            setTimeout(function() {
                var showEl = document.getElementById(screenId);
                if (showEl) {
                    showEl.classList.remove('hidden');
                    showEl.classList.add('screen-fade-in');
                    setTimeout(function() {
                        showEl.classList.remove('screen-fade-in');
                    }, 400);
                }
            }, hideScreens.length > 0 ? 250 : 0);
        }

        // Global error handler to catch any JS errors
        window.onerror = function(msg, url, line, col, error) {
            addDebug('ERROR: ' + msg + ' at line ' + line);
            console.error('Global error:', msg, url, line, col, error);
            return false;
        };

        // Catch promise rejections
        window.addEventListener('unhandledrejection', function(event) {
            addDebug('Promise error: ' + event.reason);
            console.error('Unhandled rejection:', event.reason);
        });

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // FULLSCREEN REQUEST FUNCTIONS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function requestFullscreen() {
            // First expand Telegram WebApp
            if (window.Telegram && window.Telegram.WebApp) {
                window.Telegram.WebApp.expand();
            }
            
            // Then request native fullscreen
            var elem = document.documentElement;
            try {
                if (elem.requestFullscreen) {
                    elem.requestFullscreen().catch(function(err) {
                        console.log('Fullscreen request failed:', err);
                        window.scrollTo(0, 1); // Fallback: hide address bar
                    });
                } else if (elem.webkitRequestFullscreen) {
                    elem.webkitRequestFullscreen();
                } else if (elem.mozRequestFullScreen) {
                    elem.mozRequestFullScreen();
                } else if (elem.msRequestFullscreen) {
                    elem.msRequestFullscreen();
                } else {
                    window.scrollTo(0, 1); // Fallback
                }
            } catch(e) {
                console.log('Fullscreen not supported:', e);
                window.scrollTo(0, 1);
            }
        }

        function enableFullscreenAndContinue() {
            localStorage.setItem('hasSeenFullscreenRequest', 'true');
            requestFullscreen();
            document.getElementById('fullscreenRequestScreen').classList.add('hidden');
            document.getElementById('splashScreen').style.display = 'flex';
            startSplashTimer();
        }

        function skipFullscreenAndContinue() {
            localStorage.setItem('hasSeenFullscreenRequest', 'true');
            document.getElementById('fullscreenRequestScreen').classList.add('hidden');
            document.getElementById('splashScreen').style.display = 'flex';
            startSplashTimer();
        }

        function showSplashScreen() {
            document.getElementById('splashScreen').style.display = 'flex';
            startSplashTimer();
        }

        // Telegram WebApp - check existence, not initData value
        var tg = window.Telegram && window.Telegram.WebApp;
        var isTelegramApp = !!(tg && typeof tg.initData !== 'undefined');
        
        if (tg) {
            try {
                tg.ready();
                tg.expand();
            } catch(e) {}
            addDebug('TG OK');
        }

        // Hide initial loader
        function hideInitialLoader() {
            var loader = document.getElementById('initialLoader');
            if (loader) loader.classList.add('loaded');
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // APP INITIALIZATION
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        window.addEventListener('DOMContentLoaded', function() {
            addDebug('DOM loaded');
            
            // Hide loader first
            hideInitialLoader();
            
            try {
                // In Telegram: skip all intermediate screens
                if (isTelegramApp) {
                    addDebug('Telegram app - fast load');
                    document.getElementById('splashScreen').style.display = 'none';
                    document.getElementById('fullscreenRequestScreen').classList.add('hidden');
                    document.getElementById('mainMenu').classList.remove('hidden');
                    try { updateUserUI(); } catch(e) {}
                    return;
                }
                
                // In browser: check for fullscreen request
                var hasSeenRequest = false;
                try { hasSeenRequest = localStorage.getItem('hasSeenFullscreenRequest'); } catch(e) {}
                
                if (!hasSeenRequest) {
                    document.getElementById('splashScreen').style.display = 'none';
                    document.getElementById('fullscreenRequestScreen').classList.remove('hidden');
                } else {
                    document.getElementById('fullscreenRequestScreen').classList.add('hidden');
                    document.getElementById('splashScreen').style.display = 'flex';
                    startSplashTimer();
                }
            } catch (e) {
                addDebug('Init error: ' + e.message);
                // Ultimate fallback
                document.getElementById('mainMenu').classList.remove('hidden');
            }
        });

        // User info
        var user = tg && tg.initDataUnsafe && tg.initDataUnsafe.user;
        var telegramUserId = user ? user.id : null;
        var userName = user ? user.first_name : 'Guest';
        var userHandle = user && user.username ? '@' + user.username : '';
        var userInitial = userName ? userName.charAt(0).toUpperCase() : 'P';
        var userBalance = 1000; // Default balance, will be updated from server

        addDebug('User: ' + userName + (telegramUserId ? ' #' + telegramUserId : ''));

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // USER REGISTRATION / INIT
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        var API_BASE = 'https://poker-game-poker-game.up.railway.app';

        async function initUser() {
            if (!telegramUserId) {
                addDebug('No TG ID - guest mode');
                return;
            }

            try {
                var response = await fetch(API_BASE + '/api/user/init', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        telegram_id: telegramUserId,
                        username: user.username || null,
                        first_name: userName
                    })
                });

                if (response.ok) {
                    var data = await response.json();
                    userBalance = data.balance || 1000;
                    updateBalanceUI();
                    addDebug('User init OK: $' + userBalance);
                } else {
                    addDebug('User init failed: ' + response.status);
                }
            } catch (err) {
                addDebug('User init error: ' + err.message);
                // Continue with default balance
            }
        }

        function updateBalanceUI() {
            var balanceStr = '$' + userBalance.toLocaleString();
            var menuBalanceEl = document.getElementById('menuBalance');
            var lobbyBalanceEl = document.getElementById('lobbyBalance');
            if (menuBalanceEl) menuBalanceEl.textContent = balanceStr;
            if (lobbyBalanceEl) lobbyBalanceEl.textContent = balanceStr;
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // SPLASH SCREEN
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        var welcomePhrases = [
            "Welcome, cowboy. Let's play!",
            "Howdy, partner! Ready to go all-in?",
            "Saddle up, gunslinger. Fortune awaits!",
            "Time to show your poker face, partner!",
            "Draw your cards, cowboy. Let the game begin!"
        ];

        var splashTimeout = null;
        
        function startSplashTimer() {
            if (splashTimeout) clearTimeout(splashTimeout);
            
            // Set random phrase safely
            var phraseEl = document.getElementById('splashPhrase');
            if (phraseEl) {
                var randomPhrase = welcomePhrases[Math.floor(Math.random() * welcomePhrases.length)];
                phraseEl.textContent = randomPhrase;
            }
            
            // Transition to main menu after 3 seconds
            splashTimeout = setTimeout(function() {
                var splashEl = document.getElementById('splashScreen');
                var menuEl = document.getElementById('mainMenu');
                
                if (splashEl) splashEl.classList.add('hidden');
                if (menuEl) menuEl.classList.remove('hidden');
                
                updateUserUI();
                initUser(); // Register/load user from backend
                addDebug('Menu shown');
            }, 3000);
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // UI UPDATES
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function updateUserUI() {
            // Main menu
            var menuAvatar = document.getElementById('menuAvatar');
            var menuName = document.getElementById('menuName');
            var menuHandle = document.getElementById('menuHandle');
            if (menuAvatar) menuAvatar.textContent = userInitial;
            if (menuName) menuName.textContent = userName || 'Player';
            if (menuHandle) menuHandle.textContent = userHandle;

            // Lobby sidebar
            var lobbyAvatar = document.getElementById('lobbyAvatar');
            var lobbyName = document.getElementById('lobbyName');
            var lobbyHandle = document.getElementById('lobbyHandle');
            if (lobbyAvatar) lobbyAvatar.textContent = userInitial;
            if (lobbyName) lobbyName.textContent = userName || 'Player';
            if (lobbyHandle) lobbyHandle.textContent = userHandle;
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // NAVIGATION
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        var currentMode = '';

        function openLobby(mode) {
            currentMode = mode;
            addDebug('Open: ' + mode);

            // Private Game opens a special modal instead of lobby screen
            if (mode === 'private') {
                openPrivateGameModal();
                return;
            }

            var titles = {
                tournament: 'ğŸ† Tournament Lobby',
                bounty: 'ğŸ¯ Bounty Hunter Lobby',
                sitgo: 'âš¡ Sit & Go Lobby',
                private: 'ğŸ° Private Games'
            };

            document.getElementById('lobbyTitle').textContent = titles[mode] || 'Lobby';
            document.getElementById('mainMenu').classList.add('hidden');
            document.getElementById('lobbyScreen').classList.remove('hidden');

            renderTables(mode);
        }

        function goBack() {
            addDebug('Back');
            document.getElementById('lobbyScreen').classList.add('hidden');
            document.getElementById('mainMenu').classList.remove('hidden');
        }

        function switchTab(btn, filter) {
            var tabs = document.querySelectorAll('.lobby-tab');
            tabs.forEach(function(t) { t.classList.remove('active'); });
            btn.classList.add('active');
            renderTables(currentMode, filter);
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // TABLES DATA & RENDERING
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        var tablesData = {
            tournament: [
                { name: 'Daily Freeroll', buyIn: 'Free', players: '45/100', blinds: '50/100', status: 'open' },
                { name: 'Sunday Major', buyIn: '$50', players: '120/200', blinds: '100/200', status: 'open' },
                { name: 'High Roller', buyIn: '$500', players: '18/20', blinds: '500/1000', status: 'waiting' }
            ],
            bounty: [
                { name: 'Headhunter $10', buyIn: '$10', players: '32/50', blinds: '25/50', status: 'open' },
                { name: 'Knockout King', buyIn: '$25', players: '64/100', blinds: '50/100', status: 'open' }
            ],
            sitgo: [
                { name: 'Turbo 6-Max', buyIn: '$5', players: '4/6', blinds: '25/50', status: 'waiting' },
                { name: 'Hyper 9-Max', buyIn: '$10', players: '9/9', blinds: '50/100', status: 'full' },
                { name: 'Standard 6-Max', buyIn: '$20', players: '2/6', blinds: '25/50', status: 'open' }
            ],
            private: [
                { name: 'Friends Only', buyIn: '$10', players: '3/8', blinds: '10/20', status: 'waiting' },
                { name: 'VIP Room', buyIn: '$100', players: '5/6', blinds: '50/100', status: 'open' }
            ]
        };

        function renderTables(mode, filter) {
            var tables = tablesData[mode] || [];
            var container = document.getElementById('tablesList');
            var html = '';

            tables.forEach(function(table) {
                var statusClass = table.status === 'waiting' ? 'waiting' : (table.status === 'full' ? 'full' : '');
                var statusText = table.status === 'open' ? 'Open' : (table.status === 'waiting' ? 'Starting...' : 'Full');

                html += '<div class="table-card">' +
                    '<div class="table-card-header">' +
                        '<div class="table-name">' + table.name + '</div>' +
                        '<div class="table-status ' + statusClass + '">' + statusText + '</div>' +
                    '</div>' +
                    '<div class="table-info">' +
                        '<span>ğŸ’° ' + table.buyIn + '</span>' +
                        '<span>ğŸ‘¥ ' + table.players + '</span>' +
                        '<span>ğŸ¯ ' + table.blinds + '</span>' +
                    '</div>' +
                    '<button class="join-btn" onclick="joinTable(\'' + table.name + '\')">Join Table</button>' +
                '</div>';
            });

            if (tables.length === 0) {
                html = '<div style="text-align:center;color:#64748b;padding:40px;">No tables available</div>';
            }

            container.innerHTML = html;
        }

        function joinTable(tableName) {
            addDebug('Join: ' + tableName);
            // Portrait mode is now default - load directly
            loadPokerTable(tableName);
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // DEVICE DETECTION
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        var deviceType = (function() {
            var ua = navigator.userAgent;
            var isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(ua);
            var isTablet = /(tablet|ipad|playbook|silk)|(android(?!.*mobi))/i.test(ua.toLowerCase());
            var w = window.innerWidth;
            if (isMobile && w < 768) return 'mobile';
            if (isTablet || (w >= 768 && w < 1024)) return 'tablet';
            return 'desktop';
        })();
        document.body.classList.add('device-' + deviceType);
        addDebug('Device: ' + deviceType);

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // CARD DECK & HAND EVALUATION
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        var RANKS = ['2','3','4','5','6','7','8','9','10','J','Q','K','A'];
        var SUITS = ['â™¥','â™¦','â™£','â™ '];
        var RANK_VALUES = {'2':2,'3':3,'4':4,'5':5,'6':6,'7':7,'8':8,'9':9,'10':10,'J':11,'Q':12,'K':13,'A':14};
        var RANK_NAMES = {14:'Ace',13:'King',12:'Queen',11:'Jack',10:'Ten',9:'Nine',8:'Eight',7:'Seven',6:'Six',5:'Five',4:'Four',3:'Three',2:'Two'};

        function createDeck() {
            var deck = [];
            SUITS.forEach(function(suit) {
                RANKS.forEach(function(rank) {
                    deck.push({ rank: rank, suit: suit });
                });
            });
            // Shuffle
            for (var i = deck.length - 1; i > 0; i--) {
                var j = Math.floor(Math.random() * (i + 1));
                var temp = deck[i]; deck[i] = deck[j]; deck[j] = temp;
            }
            return deck;
        }

        function getCardValue(card) { return RANK_VALUES[card.rank] || 0; }
        function isRed(suit) { return suit === 'â™¥' || suit === 'â™¦'; }
        function formatCard(card) { return card.rank + card.suit; }

        function evaluateHand(cards) {
            if (cards.length < 5) return { rank: 0, name: 'Not enough cards', cards: [] };
            
            // Get all 5-card combinations
            var combos = getCombinations(cards, 5);
            var best = null;
            
            combos.forEach(function(combo) {
                var result = evaluateFiveCards(combo);
                if (!best || result.rank > best.rank) best = result;
            });
            
            return best || { rank: 0, name: 'High Card', cards: cards.slice(0,5) };
        }

        function getCombinations(arr, size) {
            if (size === 1) return arr.map(function(x) { return [x]; });
            if (size > arr.length) return [];
            var result = [];
            for (var i = 0; i <= arr.length - size; i++) {
                var head = arr[i];
                var tails = getCombinations(arr.slice(i + 1), size - 1);
                tails.forEach(function(tail) { result.push([head].concat(tail)); });
            }
            return result;
        }

        function evaluateFiveCards(cards) {
            var sorted = cards.slice().sort(function(a,b) { return getCardValue(b) - getCardValue(a); });
            var values = sorted.map(getCardValue);
            var suits = sorted.map(function(c) { return c.suit; });
            
            var isFlush = suits.every(function(s) { return s === suits[0]; });
            var isStraight = checkStraight(values);
            var groups = groupByValue(values);
            var counts = Object.values(groups).sort(function(a,b) { return b - a; });
            
            // Helper: get cards by their value count
            function getCardsByCount(count) {
                var result = [];
                var valueGroups = {};
                sorted.forEach(function(c) {
                    var v = getCardValue(c);
                    if (!valueGroups[v]) valueGroups[v] = [];
                    valueGroups[v].push(c);
                });
                for (var v in valueGroups) {
                    if (valueGroups[v].length === count) {
                        result = result.concat(valueGroups[v]);
                    }
                }
                return result;
            }
            
            // Royal Flush - all 5 cards form the combo
            if (isFlush && isStraight && values[0] === 14 && values[4] === 10) {
                return { rank: 10, name: 'Royal Flush', cards: sorted };
            }
            // Straight Flush - all 5 cards
            if (isFlush && isStraight) {
                return { rank: 9, name: 'Straight Flush', cards: sorted };
            }
            // Four of a Kind - only the 4 matching cards
            if (counts[0] === 4) {
                return { rank: 8, name: 'Four of a Kind', cards: getCardsByCount(4) };
            }
            // Full House - all 5 cards (3 + 2)
            if (counts[0] === 3 && counts[1] === 2) {
                return { rank: 7, name: 'Full House', cards: sorted };
            }
            // Flush - all 5 cards
            if (isFlush) {
                return { rank: 6, name: 'Flush', cards: sorted };
            }
            // Straight - all 5 cards
            if (isStraight) {
                return { rank: 5, name: 'Straight', cards: sorted };
            }
            // Three of a Kind - only the 3 matching cards
            if (counts[0] === 3) {
                return { rank: 4, name: 'Three of a Kind', cards: getCardsByCount(3) };
            }
            // Two Pair - only the 4 cards that form both pairs
            if (counts[0] === 2 && counts[1] === 2) {
                return { rank: 3, name: 'Two Pair', cards: getCardsByCount(2) };
            }
            // One Pair - only the 2 matching cards
            if (counts[0] === 2) {
                return { rank: 2, name: 'One Pair', cards: getCardsByCount(2) };
            }
            // High Card - no cards to highlight
            return { rank: 1, name: 'High Card', cards: [] };
        }

        function checkStraight(values) {
            for (var i = 0; i < 4; i++) {
                if (values[i] - values[i+1] !== 1) {
                    // Check wheel (A-2-3-4-5)
                    if (i === 0 && values[0] === 14 && values[1] === 5 && values[2] === 4 && values[3] === 3 && values[4] === 2) {
                        return true;
                    }
                    return false;
                }
            }
            return true;
        }

        function groupByValue(values) {
            var groups = {};
            values.forEach(function(v) { groups[v] = (groups[v] || 0) + 1; });
            return groups;
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // GAME STATE
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        var gameState = {
            phase: 'waiting', // waiting, preflop, flop, turn, river, showdown
            deck: [],
            communityCards: [],
            pot: 0,
            currentBet: 0,
            smallBlind: 10,
            bigBlind: 20,
            dealerSeat: 0,
            currentPlayerSeat: null,
            timeRemaining: 30,
            timerInterval: null,
            players: [
                { seat: 0, name: userName || 'You', chips: userBalance, cards: [], bet: 0, status: 'active', isHero: true },
                { seat: 1, name: 'Alex', chips: 850, cards: [], bet: 0, status: 'active' },
                { seat: 3, name: 'Maria', chips: 1200, cards: [], bet: 0, status: 'active' },
                { seat: 4, name: 'John', chips: 950, cards: [], bet: 0, status: 'active' },
                { seat: 5, name: 'Kate', chips: 720, cards: [], bet: 0, status: 'active' }
            ]
        };

        function getPlayer(seat) {
            return gameState.players.find(function(p) { return p.seat === seat; });
        }

        function getHero() {
            return gameState.players.find(function(p) { return p.isHero; });
        }

        function getActivePlayers() {
            return gameState.players.filter(function(p) { return p.status === 'active'; });
        }

        function getNextActiveSeat(currentSeat) {
            var seats = gameState.players.map(function(p) { return p.seat; }).sort(function(a,b) { return a - b; });
            var idx = seats.indexOf(currentSeat);
            for (var i = 1; i <= seats.length; i++) {
                var nextIdx = (idx + i) % seats.length;
                var nextSeat = seats[nextIdx];
                var player = getPlayer(nextSeat);
                if (player && player.status === 'active') return nextSeat;
            }
            return null;
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // GAME FLOW
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function loadPokerTable(tableName) {
            addDebug('Loading: ' + tableName);
            
            // Find table data
            var tableInfo = null;
            Object.keys(tablesData).forEach(function(mode) {
                tablesData[mode].forEach(function(t) {
                    if (t.name === tableName) tableInfo = t;
                });
            });
            
            // Parse blinds from table info
            if (tableInfo && tableInfo.blinds) {
                var blinds = tableInfo.blinds.split('/');
                gameState.smallBlind = parseInt(blinds[0]) || 10;
                gameState.bigBlind = parseInt(blinds[1]) || 20;
            }
            
            // Update UI
            document.getElementById('tableInfoName').textContent = tableName;
            document.getElementById('tableInfoBlinds').textContent = 'Blinds: ' + gameState.smallBlind + '/' + gameState.bigBlind;
            
            // Reset game state
            gameState.phase = 'waiting';
            gameState.pot = 0;
            gameState.communityCards = [];
            gameState.players.forEach(function(p) {
                p.cards = [];
                p.bet = 0;
                p.status = 'active';
            });
            
            // Show table screen
            document.getElementById('lobbyScreen').classList.add('hidden');
            document.getElementById('pokerTableScreen').classList.remove('hidden');
            
            // Request fullscreen when entering game
            if (tg) tg.expand();
            requestFullscreen();
            
            // Initialize players for portrait layout
            initPortraitPlayerPositions();
            
            // Update game phase indicator
            updateGamePhaseIndicator('preflop');
            
            // Start first hand after delay
            setTimeout(startNewHand, 1500);
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // GAME PHASE INDICATOR UPDATE
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function updateGamePhaseIndicator(phase) {
            var indicator = document.getElementById('gamePhaseIndicator');
            if (!indicator) return;
            
            // Remove all phase classes
            indicator.classList.remove('flop', 'turn', 'river');
            
            var phaseNames = {
                'preflop': 'PRE-FLOP',
                'flop': 'FLOP',
                'turn': 'TURN',
                'river': 'RIVER',
                'showdown': 'SHOWDOWN'
            };
            
            indicator.textContent = phaseNames[phase] || phase.toUpperCase();
            
            // Add phase-specific class for coloring
            if (phase === 'flop') indicator.classList.add('flop');
            else if (phase === 'turn') indicator.classList.add('turn');
            else if (phase === 'river') indicator.classList.add('river');
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // PORTRAIT PLAYER POSITIONING
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function initPortraitPlayerPositions() {
            // For 6-max table, user is always seat 0 (bottom center)
            // Other players arranged clockwise
            var positions = [
                'seat-0',  // Bottom (USER)
                'seat-1',  // Left lower
                'seat-2',  // Left upper
                'seat-3',  // Top
                'seat-4',  // Right upper
                'seat-5'   // Right lower
            ];
            
            gameState.players.forEach(function(player, index) {
                player.position = positions[index % 6];
            });
        }

        function startNewHand() {
            addDebug('New hand');
            gameState.phase = 'preflop';
            gameState.pot = 0;
            gameState.currentBet = gameState.bigBlind;
            gameState.communityCards = [];
            gameState.deck = createDeck();
            
            // IMPORTANT: Clear community cards display immediately!
            updateCommunityCards();
            
            // Reset players
            gameState.players.forEach(function(p) {
                p.cards = [];
                p.bet = 0;
                if (p.chips > 0) p.status = 'active';
            });
            
            // Rotate dealer
            gameState.dealerSeat = getNextActiveSeat(gameState.dealerSeat) || 0;
            
            // Post blinds
            var sbSeat = getNextActiveSeat(gameState.dealerSeat);
            var bbSeat = getNextActiveSeat(sbSeat);
            
            var sbPlayer = getPlayer(sbSeat);
            var bbPlayer = getPlayer(bbSeat);
            
            if (sbPlayer) {
                var sbAmount = Math.min(gameState.smallBlind, sbPlayer.chips);
                sbPlayer.chips -= sbAmount;
                sbPlayer.bet = sbAmount;
                gameState.pot += sbAmount;
            }
            
            if (bbPlayer) {
                var bbAmount = Math.min(gameState.bigBlind, bbPlayer.chips);
                bbPlayer.chips -= bbAmount;
                bbPlayer.bet = bbAmount;
                gameState.pot += bbAmount;
            }
            
            // Deal cards
            dealPlayerCards();
            
            // First to act is after BB
            gameState.currentPlayerSeat = getNextActiveSeat(bbSeat);
            
            // Update UI
            updateGameUI();
            updatePhaseDisplay();
            
            // Start timer if not hero's turn
            startTurnTimer();
        }

        function dealPlayerCards() {
            gameState.players.forEach(function(p) {
                if (p.status === 'active' && gameState.deck.length >= 2) {
                    p.cards = [gameState.deck.pop(), gameState.deck.pop()];
                }
            });
            
            // Update hero cards display with combo highlighting
            var hero = getHero();
            if (hero && hero.cards.length === 2) {
                var heroCardsEl = document.getElementById('heroCards');
                var comboCardKeys = getComboCardKeys();
                
                heroCardsEl.innerHTML = hero.cards.map(function(card) {
                    var cardKey = card.rank + card.suit;
                    var isComboCard = comboCardKeys.indexOf(cardKey) !== -1;
                    var comboClass = isComboCard ? ' combo-card' : '';
                    
                    return '<div class="hero-card ' + (isRed(card.suit) ? 'red' : 'black') + comboClass + '">' +
                        '<span class="card-rank">' + card.rank + '</span>' +
                        '<span class="card-suit">' + card.suit + '</span>' +
                    '</div>';
                }).join('');
            }
        }

        function advancePhase() {
            clearInterval(gameState.timerInterval);
            
            // Reset bets for new round
            gameState.players.forEach(function(p) { p.bet = 0; });
            gameState.currentBet = 0;
            
            switch(gameState.phase) {
                case 'preflop':
                    dealFlop();
                    break;
                case 'flop':
                    dealTurn();
                    break;
                case 'turn':
                    dealRiver();
                    break;
                case 'river':
                    showdown();
                    break;
            }
        }

        function dealFlop() {
            gameState.phase = 'flop';
            addDebug('Dealing flop');
            
            // Burn one, deal three
            gameState.deck.pop();
            for (var i = 0; i < 3; i++) {
                gameState.communityCards.push(gameState.deck.pop());
            }
            
            updateCommunityCards();
            updatePhaseDisplay();
            startBettingRound();
        }

        function dealTurn() {
            gameState.phase = 'turn';
            addDebug('Dealing turn');
            
            gameState.deck.pop();
            gameState.communityCards.push(gameState.deck.pop());
            
            updateCommunityCards();
            updatePhaseDisplay();
            startBettingRound();
        }

        function dealRiver() {
            gameState.phase = 'river';
            addDebug('Dealing river');
            
            gameState.deck.pop();
            gameState.communityCards.push(gameState.deck.pop());
            
            updateCommunityCards();
            updatePhaseDisplay();
            startBettingRound();
        }

        function startBettingRound() {
            // First to act after dealer
            gameState.currentPlayerSeat = getNextActiveSeat(gameState.dealerSeat);
            updateGameUI();
            startTurnTimer();
        }

        function showdown() {
            gameState.phase = 'showdown';
            addDebug('Showdown!');
            updatePhaseDisplay();
            
            var activePlayers = getActivePlayers();
            
            if (activePlayers.length === 1) {
                // Everyone else folded
                declareWinner(activePlayers[0], 'Last player standing');
                return;
            }
            
            // Evaluate hands
            var results = activePlayers.map(function(player) {
                var allCards = player.cards.concat(gameState.communityCards);
                var hand = evaluateHand(allCards);
                return { player: player, hand: hand };
            });
            
            // Sort by hand rank
            results.sort(function(a, b) { return b.hand.rank - a.hand.rank; });
            
            var winner = results[0].player;
            var handName = results[0].hand.name;
            
            declareWinner(winner, handName);
        }

        function declareWinner(winner, handName) {
            addDebug('Winner: ' + winner.name + ' - ' + handName);
            
            // Award pot
            winner.chips += gameState.pot;
            
            // Show winner animation
            showWinnerPopup(winner, handName, gameState.pot);
            
            // Update balance if hero won
            if (winner.isHero) {
                userBalance = winner.chips;
                updateBalanceUI();
            }
            
            // Start new hand after delay
            setTimeout(function() {
                hideWinnerPopup();
                startNewHand();
            }, 5000);
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // TIMER SYSTEM
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function startTurnTimer() {
            gameState.timeRemaining = 30;
            updateTimerDisplay();
            
            clearInterval(gameState.timerInterval);
            gameState.timerInterval = setInterval(function() {
                gameState.timeRemaining--;
                updateTimerDisplay();
                
                if (gameState.timeRemaining <= 0) {
                    // Auto-action on timeout
                    var currentPlayer = getPlayer(gameState.currentPlayerSeat);
                    if (currentPlayer) {
                        if (currentPlayer.isHero) {
                            playerAction('fold'); // Auto-fold hero
                        } else {
                            aiAction(currentPlayer); // AI decides
                        }
                    }
                }
            }, 1000);
            
            // If not hero's turn, trigger AI action
            var currentPlayer = getPlayer(gameState.currentPlayerSeat);
            if (currentPlayer && !currentPlayer.isHero) {
                setTimeout(function() {
                    aiAction(currentPlayer);
                }, 1500 + Math.random() * 2000); // Random delay 1.5-3.5s
            }
        }

        function aiAction(player) {
            if (gameState.currentPlayerSeat !== player.seat) return;
            
            var callAmount = gameState.currentBet - player.bet;
            var random = Math.random();
            
            // Simple AI: 30% fold, 50% call, 20% raise
            if (callAmount > player.chips * 0.5 || random < 0.15) {
                // Fold if bet is too high or random fold
                doPlayerFold(player);
            } else if (random < 0.8) {
                // Call
                doPlayerCall(player);
            } else {
                // Raise
                var raiseAmount = gameState.currentBet + gameState.bigBlind * 2;
                doPlayerRaise(player, raiseAmount);
            }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // BET SLIDER & QUICK BETS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        var currentBetAmount = 20;

        function updateBetSlider(value) {
            currentBetAmount = parseInt(value);
            document.getElementById('betDisplay').textContent = '$' + currentBetAmount;
            document.getElementById('raiseBtn').textContent = (gameState.currentBet > 0 ? 'Raise' : 'Bet') + ' $' + currentBetAmount;
        }

        function quickBet(multiplier) {
            var base = gameState.bigBlind;
            var newBet = Math.min(Math.floor(base * multiplier), getHero().chips);
            currentBetAmount = newBet;
            document.getElementById('betSlider').value = newBet;
            updateBetSlider(newBet);
            
            // Highlight active quick bet button
            document.querySelectorAll('.quick-bet-btn').forEach(function(btn) {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // PLAYER ACTIONS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function playerAction(action) {
            addDebug('playerAction called: ' + action);
            
            // If in multiplayer game, use WebSocket
            if (currentGameSession && gameWebSocket) {
                addDebug('Sending multiplayer action: ' + action);
                var amount = 0;
                var serverAction = action;
                
                // Convert actions for server
                if (action === 'bet') {
                    serverAction = 'raise';  // BET is same as RAISE for server
                    amount = currentBetAmount || 20;
                } else if (action === 'raise') {
                    amount = currentBetAmount || 20;
                } else if (action === 'allin') {
                    serverAction = 'all_in';
                }
                
                addDebug('Server action: ' + serverAction + ', amount: ' + amount);
                sendGameAction(serverAction, amount);
                return;
            }
            
            // Fallback to local game logic
            var hero = getHero();
            if (!hero || gameState.currentPlayerSeat !== hero.seat) {
                addDebug('Not your turn!');
                return;
            }
            
            addDebug('Local action: ' + action);
            
            switch(action) {
                case 'fold':
                    showShowMuckModal(hero.cards);
                    doPlayerFold(hero);
                    break;
                case 'call':
                    doPlayerCall(hero);
                    break;
                case 'raise':
                    doPlayerRaise(hero, currentBetAmount);
                    break;
                case 'allin':
                    doPlayerRaise(hero, hero.chips + hero.bet);
                    break;
            }
        }

        function doPlayerFold(player) {
            player.status = 'folded';
            addDebug(player.name + ' folds');
            advanceToNextPlayer();
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // SHOW/MUCK MODAL
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        var showMuckTimeout = null;

        function showShowMuckModal(cards) {
            if (!cards || cards.length < 2) return;
            
            var modal = document.getElementById('showmuckModal');
            var cardsContainer = document.getElementById('showmuckCards');
            
            cardsContainer.innerHTML = cards.map(function(card) {
                return '<div class="hero-card ' + (isRed(card.suit) ? 'red' : 'black') + '">' +
                    '<span class="card-rank">' + card.rank + '</span>' +
                    '<span class="card-suit">' + card.suit + '</span>' +
                '</div>';
            }).join('');
            
            modal.classList.remove('hidden');
            
            // Auto-muck after 8 seconds
            showMuckTimeout = setTimeout(muckCards, 8000);
        }

        function showCards() {
            clearTimeout(showMuckTimeout);
            document.getElementById('showmuckModal').classList.add('hidden');
            addDebug('Cards shown!');
            // In real game: broadcast to other players
        }

        function muckCards() {
            clearTimeout(showMuckTimeout);
            document.getElementById('showmuckModal').classList.add('hidden');
            addDebug('Cards mucked');
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // HAND STRENGTH HUD
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        var handIcons = {
            'Royal Flush': 'ğŸ‘‘',
            'Straight Flush': 'ğŸ’',
            'Four of a Kind': 'ğŸ”¥',
            'Full House': 'ğŸ ',
            'Flush': 'â™ ï¸',
            'Straight': 'ğŸ“Š',
            'Three of a Kind': 'ğŸ¯',
            'Two Pair': 'ğŸ‘¥',
            'One Pair': 'ğŸ²',
            'High Card': 'ğŸƒ'
        };

        function updateHandHUD() {
            var hero = getHero();
            if (!hero || !hero.cards || hero.cards.length < 2 || gameState.communityCards.length < 3) {
                document.getElementById('handHud').classList.add('hidden');
                return;
            }
            
            var allCards = hero.cards.concat(gameState.communityCards);
            var hand = evaluateHand(allCards);
            
            var hud = document.getElementById('handHud');
            hud.classList.remove('hidden', 'legendary', 'epic', 'rare');
            
            // Add rarity class
            if (hand.rank >= 9) hud.classList.add('legendary');
            else if (hand.rank >= 7) hud.classList.add('epic');
            else if (hand.rank >= 5) hud.classList.add('rare');
            
            document.getElementById('handIcon').textContent = handIcons[hand.name] || 'ğŸƒ';
            document.getElementById('handRank').textContent = hand.name;
            document.getElementById('handDesc').textContent = getHandDescription(hand);
        }

        function getHandDescription(hand) {
            if (!hand.cards || hand.cards.length === 0) return '';
            var highCard = hand.cards[0];
            return RANK_NAMES[RANK_VALUES[highCard.rank]] + ' high';
        }

        function doPlayerCall(player) {
            var callAmount = Math.min(gameState.currentBet - player.bet, player.chips);
            
            if (callAmount === 0) {
                addDebug(player.name + ' checks');
            } else {
                player.chips -= callAmount;
                player.bet += callAmount;
                gameState.pot += callAmount;
                addDebug(player.name + ' calls $' + callAmount);
            }
            
            updateGameUI();
            advanceToNextPlayer();
        }

        function doPlayerRaise(player, totalBet) {
            var raiseAmount = Math.min(totalBet - player.bet, player.chips);
            
            player.chips -= raiseAmount;
            player.bet += raiseAmount;
            gameState.pot += raiseAmount;
            gameState.currentBet = player.bet;
            
            addDebug(player.name + ' raises to $' + player.bet);
            
            updateGameUI();
            advanceToNextPlayer();
        }

        function advanceToNextPlayer() {
            clearInterval(gameState.timerInterval);
            
            // Check if only one player left
            var activePlayers = getActivePlayers();
            if (activePlayers.length <= 1) {
                showdown();
                return;
            }
            
            // Check if betting round is complete
            if (isBettingRoundComplete()) {
                advancePhase();
                return;
            }
            
            // Next player
            gameState.currentPlayerSeat = getNextActiveSeat(gameState.currentPlayerSeat);
            updateGameUI();
            startTurnTimer();
        }

        function isBettingRoundComplete() {
            var activePlayers = getActivePlayers();
            return activePlayers.every(function(p) {
                return p.bet === gameState.currentBet || p.chips === 0;
            });
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // UI UPDATES
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function updateGameUI() {
            // Update pot (center)
            document.getElementById('potAmount').textContent = '$' + gameState.pot;
            
            // Update players
            renderPlayersOnTable();
            
            // Update action buttons
            updateActionButtons();
            
            // Update bet slider limits
            updateBetSliderLimits();
            
            // Update hand HUD
            updateHandHUD();
        }

        function updatePhaseDisplay() {
            var phaseNames = {
                'waiting': 'WAITING',
                'preflop': 'PRE-FLOP',
                'flop': 'FLOP',
                'turn': 'TURN',
                'river': 'RIVER',
                'showdown': 'SHOWDOWN'
            };
            
            // Update game phase indicator (new floating indicator)
            updateGamePhaseIndicator(gameState.phase);
            
            // Also update header blinds
            var phaseEl = document.getElementById('tableInfoBlinds');
            if (phaseEl) {
                phaseEl.textContent = 'Blinds: ' + gameState.smallBlind + '/' + gameState.bigBlind;
            }
        }

        function updateTimerDisplay() {
            var currentPlayer = getPlayer(gameState.currentPlayerSeat);
            if (!currentPlayer) return;
            
            // Visual indicator on active player
            renderPlayersOnTable();
        }

        function updateBetSliderLimits() {
            var hero = getHero();
            if (!hero) return;
            
            var slider = document.getElementById('betSlider');
            slider.min = gameState.bigBlind;
            slider.max = hero.chips;
            
            // Ensure current bet is within limits
            if (currentBetAmount < gameState.bigBlind) {
                currentBetAmount = gameState.bigBlind;
                slider.value = currentBetAmount;
                updateBetSlider(currentBetAmount);
            }
        }

        function updateCommunityCards() {
            var container = document.getElementById('communityCards');
            var html = '';
            
            // Get hero's winning combo cards (if any) for highlighting
            var comboCardKeys = getComboCardKeys();
            
            gameState.communityCards.forEach(function(card, index) {
                // Check if this card is part of the winning combo
                var cardKey = card.rank + card.suit;
                var isComboCard = comboCardKeys.indexOf(cardKey) !== -1;
                var comboClass = isComboCard ? ' combo-card' : '';
                
                // Add flip animation class for new cards
                var animClass = 'card-container';
                html += '<div class="' + animClass + '">' +
                    '<div class="card ' + (isRed(card.suit) ? 'red' : 'black') + comboClass + '">' +
                        '<span class="card-rank">' + card.rank + '</span>' +
                        '<span class="card-suit">' + card.suit + '</span>' +
                    '</div>' +
                '</div>';
            });
            
            // NO hidden placeholders - only show actual dealt cards
            // This fixes the PRE-FLOP bug where 5 cards were shown
            
            container.innerHTML = html;
            
            // Update hand HUD after community cards change
            updateHandHUD();
            
            // Update hero cards highlighting when community cards change
            updateHeroCardsHighlight();
        }
        
        // Update hero cards to show combo highlighting
        function updateHeroCardsHighlight() {
            var hero = getHero();
            if (!hero || !hero.cards || hero.cards.length < 2) return;
            
            var heroCardsEl = document.getElementById('heroCards');
            var comboCardKeys = getComboCardKeys();
            
            heroCardsEl.innerHTML = hero.cards.map(function(card) {
                var cardKey = card.rank + card.suit;
                var isComboCard = comboCardKeys.indexOf(cardKey) !== -1;
                var comboClass = isComboCard ? ' combo-card' : '';
                
                return '<div class="hero-card ' + (isRed(card.suit) ? 'red' : 'black') + comboClass + '">' +
                    '<span class="card-rank">' + card.rank + '</span>' +
                    '<span class="card-suit">' + card.suit + '</span>' +
                '</div>';
            }).join('');
        }
        
        // Get card keys that form the winning combination for hero
        // ONLY highlights cards for REAL combinations (not HIGH CARD)
        function getComboCardKeys() {
            var hero = getHero();
            if (!hero || !hero.cards || hero.cards.length < 2 || gameState.communityCards.length < 3) {
                return [];
            }
            
            var allCards = hero.cards.concat(gameState.communityCards);
            var hand = evaluateHand(allCards);
            
            if (!hand || !hand.cards) return [];
            
            // DON'T highlight for HIGH CARD (rank 1) - only real combinations
            // Rank 1 = High Card, Rank 2 = One Pair, Rank 3 = Two Pair, etc.
            if (hand.rank <= 1) {
                return []; // No highlighting for High Card
            }
            
            // Return keys of cards in the winning combo
            return hand.cards.map(function(c) { return c.rank + c.suit; });
        }

        function updateActionButtons() {
            var hero = getHero();
            var isMyTurn = hero && gameState.currentPlayerSeat === hero.seat;
            var callAmount = gameState.currentBet - (hero ? hero.bet : 0);
            
            // Update call button
            var callBtn = document.getElementById('callBtn');
            if (callBtn) {
                callBtn.textContent = callAmount > 0 ? 'Call $' + callAmount : 'Check';
                callBtn.className = 'action-btn ' + (callAmount > 0 ? 'call' : 'check');
                callBtn.disabled = !isMyTurn;
            }
            
            // Update raise button
            var raiseBtn = document.getElementById('raiseBtn');
            if (raiseBtn) {
                raiseBtn.textContent = (gameState.currentBet > 0 ? 'Raise' : 'Bet') + ' $' + currentBetAmount;
                raiseBtn.disabled = !isMyTurn;
            }
            
            // Enable/disable all buttons
            var buttons = document.querySelectorAll('#actionButtons .action-btn');
            buttons.forEach(function(btn) {
                btn.disabled = !isMyTurn;
            });
            
            // Controls container
            var controls = document.getElementById('bettingControls');
            if (controls) {
                controls.classList.toggle('disabled', !isMyTurn);
            }
        }

        function renderPlayersOnTable() {
            var container = document.getElementById('playerSeats');
            var html = '';
            
            // Portrait positions for 6-max
            var positions = ['seat-0', 'seat-1', 'seat-2', 'seat-3', 'seat-4', 'seat-5'];
            var playerIndex = 0;
            
            gameState.players.forEach(function(player) {
                if (player.isHero) return; // Hero is in bottom controls
                
                var avatarClass = 'player-avatar';
                if (player.status === 'folded') avatarClass += ' folded';
                if (player.seat === gameState.dealerSeat) avatarClass += ' dealer';
                if (player.seat === gameState.currentPlayerSeat) avatarClass += ' active';
                
                var timerHtml = '';
                if (player.seat === gameState.currentPlayerSeat) {
                    timerHtml = '<div class="player-timer">' + gameState.timeRemaining + 's</div>';
                }
                
                // Use portrait position based on player index (skip 0 which is hero)
                var positionClass = positions[(playerIndex % 5) + 1];
                playerIndex++;
                
                html += '<div class="player-seat ' + positionClass + '">' +
                    '<div class="player-card-container">' +
                        '<div class="' + avatarClass + '">' + player.name.charAt(0) + timerHtml + '</div>' +
                        '<div class="player-name">' + player.name + '</div>' +
                        '<div class="player-chips">$' + player.chips + '</div>' +
                        (player.bet > 0 ? '<div class="player-bet">$' + player.bet + '</div>' : '') +
                        '<div class="player-cards"><div class="player-card"></div><div class="player-card"></div></div>' +
                    '</div>' +
                '</div>';
            });
            
            container.innerHTML = html;
        }

        function showWinnerPopup(winner, handName, amount) {
            var popup = document.createElement('div');
            popup.id = 'winnerPopup';
            popup.className = 'winner-popup';
            popup.innerHTML = 
                '<div class="winner-badge">' +
                    '<div class="winner-icon">ğŸ†</div>' +
                    '<div class="winner-name">' + winner.name + ' wins!</div>' +
                    '<div class="winner-hand">' + handName + '</div>' +
                    '<div class="winner-amount">+$' + amount + '</div>' +
                '</div>';
            document.body.appendChild(popup);
        }

        function hideWinnerPopup() {
            var popup = document.getElementById('winnerPopup');
            if (popup) popup.remove();
        }

        function leaveTable() {
            addDebug('Leave table');
            clearInterval(gameState.timerInterval);
            gameState.phase = 'waiting';
            document.getElementById('pokerTableScreen').classList.add('hidden');
            document.getElementById('lobbyScreen').classList.remove('hidden');
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // BUTTON HANDLERS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function showAlert(msg) {
            if (tg && tg.showAlert) {
                tg.showAlert(msg);
            } else {
                alert(msg);
            }
        }

        function handleDeposit() {
            addDebug('Deposit');
            showAlert('ğŸ’³ Deposit feature coming soon!');
        }

        function handleWithdraw() {
            addDebug('Withdraw');
            showAlert('ğŸ’° Withdraw feature coming soon!');
        }

        function handleHistory() {
            addDebug('History');
            showAlert('ğŸ“‹ Transaction history coming soon!');
        }

        function handleSettings() {
            addDebug('Settings');
            showAlert('âš™ï¸ Settings coming soon!');
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // PRIVATE GAME MODAL FUNCTIONS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        var currentPrivateLobby = null;

        function openPrivateGameModal() {
            addDebug('Open Private Game Modal');
            document.getElementById('privateGameModal').classList.remove('hidden');
            resetPrivateGameModal();
        }

        function closePrivateGameModal(resetLobby) {
            document.getElementById('privateGameModal').classList.add('hidden');
            // Only reset lobby if explicitly requested (e.g., user clicked X button)
            if (resetLobby === true) {
                currentPrivateLobby = null;
            }
            // Reset tabs visibility
            document.querySelector('.private-game-tabs').style.display = 'flex';
        }

        function resetPrivateGameModal() {
            // Show create view, hide others
            document.getElementById('createLobbyView').classList.remove('hidden');
            document.getElementById('joinLobbyView').classList.add('hidden');
            document.getElementById('lobbyCreatedView').classList.add('hidden');
            
            // Reset tabs
            var tabs = document.querySelectorAll('.pg-tab');
            tabs.forEach(function(t, i) {
                if (i === 0) t.classList.add('active');
                else t.classList.remove('active');
            });
            
            // Reset form
            document.getElementById('lobbyCodeInput').value = '';
        }

        function switchPrivateTab(tab, btn) {
            var tabs = document.querySelectorAll('.pg-tab');
            tabs.forEach(function(t) { t.classList.remove('active'); });
            btn.classList.add('active');
            
            if (tab === 'create') {
                document.getElementById('createLobbyView').classList.remove('hidden');
                document.getElementById('joinLobbyView').classList.add('hidden');
                document.getElementById('lobbyCreatedView').classList.add('hidden');
            } else {
                document.getElementById('createLobbyView').classList.add('hidden');
                document.getElementById('joinLobbyView').classList.remove('hidden');
                document.getElementById('lobbyCreatedView').classList.add('hidden');
            }
        }

        function generateLobbyCode() {
            var chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
            var code = '';
            for (var i = 0; i < 6; i++) {
                code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return code;
        }

        async function createPrivateLobby() {
            var buyIn = document.getElementById('buyInSelect').value;
            var maxPlayers = document.getElementById('maxPlayersSelect').value;
            var smallBlind = document.getElementById('smallBlindSelect').value;
            var bigBlind = document.getElementById('bigBlindSelect').value;
            
            addDebug('Creating lobby on server...');
            
            try {
                // Call server API to create lobby
                var response = await fetch(API_BASE + '/api/lobby/create', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        buyIn: parseInt(buyIn),
                        maxPlayers: parseInt(maxPlayers),
                        initData: tg ? tg.initData : ''
                    })
                });
                
                if (!response.ok) {
                    var errData = await response.json().catch(function() { return {}; });
                    throw new Error(errData.detail || 'Failed to create lobby');
                }
                
                var data = await response.json();
                var lobbyCode = data.lobbyCode;
                
                addDebug('Server created lobby: ' + lobbyCode);
                
                currentPrivateLobby = {
                    code: lobbyCode,
                    buyIn: parseInt(buyIn),
                    maxPlayers: parseInt(maxPlayers),
                    smallBlind: parseInt(smallBlind),
                    bigBlind: parseInt(bigBlind),
                    players: [{ name: userName, isHost: true }],
                    serverData: data.lobby,
                    isHost: true  // Creator is the host
                };
                
                // Update UI with server code
                document.getElementById('createdLobbyCode').textContent = lobbyCode;
                document.getElementById('summaryBuyIn').textContent = '$' + parseInt(buyIn).toLocaleString();
                document.getElementById('summaryBlinds').textContent = '$' + smallBlind + '/$' + bigBlind;
                document.getElementById('summaryPlayers').textContent = maxPlayers;
                document.getElementById('maxPlayersCount').textContent = maxPlayers;
                document.getElementById('hostChip').textContent = 'ğŸ‘‘ ' + userName + ' (Host)';
                
                // Show created view
                document.getElementById('createLobbyView').classList.add('hidden');
                document.getElementById('lobbyCreatedView').classList.remove('hidden');
                
                // Hide tabs when lobby is created
                document.querySelector('.private-game-tabs').style.display = 'none';
                
            } catch (err) {
                addDebug('Create lobby error: ' + err.message);
                showAlert('âš ï¸ Failed to create lobby: ' + err.message);
            }
        }

        async function joinPrivateLobby() {
            var code = document.getElementById('lobbyCodeInput').value.toUpperCase().trim();
            
            if (code.length !== 6) {
                showAlert('âš ï¸ Please enter a valid 6-character lobby code');
                return;
            }
            
            addDebug('Joining lobby via API: ' + code);
            
            try {
                // First get lobby info from server
                var lobbyResponse = await fetch(API_BASE + '/api/lobby/' + code);
                
                if (!lobbyResponse.ok) {
                    var errData = await lobbyResponse.json().catch(function() { return {}; });
                    throw new Error(errData.detail || 'Lobby not found');
                }
                
                var lobbyData = await lobbyResponse.json();
                addDebug('Found lobby on server');
                
                // Join the lobby
                var joinResponse = await fetch(API_BASE + '/api/lobby/' + code + '/join', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        initData: tg ? tg.initData : ''
                    })
                });
                
                if (!joinResponse.ok) {
                    var joinErr = await joinResponse.json().catch(function() { return {}; });
                    throw new Error(joinErr.detail || 'Failed to join lobby');
                }
                
                var joinData = await joinResponse.json();
                var serverLobby = joinData.lobby;
                
                addDebug('Joined lobby successfully');
                
                // Convert server players to our format
                var players = [];
                if (serverLobby.players) {
                    for (var playerId in serverLobby.players) {
                        var p = serverLobby.players[playerId];
                        players.push({
                            name: p.first_name || p.username || 'Player',
                            isHost: p.is_host
                        });
                    }
                }
                
                currentPrivateLobby = {
                    code: code,
                    buyIn: serverLobby.buy_in || 1000,
                    maxPlayers: serverLobby.max_players || 6,
                    smallBlind: 10,
                    bigBlind: 20,
                    players: players,
                    serverData: serverLobby,
                    isHost: false  // Guest joining
                };
                
                // Close modal and go to waiting room (NOT start game!)
                closePrivateGameModal();
                document.getElementById('mainMenu').classList.add('hidden');
                
                // Connect to WebSocket for real-time updates
                connectToLobbyWebSocket(code);
                
                // Show waiting room
                updateWaitingRoomUI();
                document.getElementById('waitingRoomScreen').classList.remove('hidden');
                
            } catch (err) {
                addDebug('Join lobby error: ' + err.message);
                showAlert('âš ï¸ ' + err.message);
            }
        }

        function inviteViaTelegram() {
            if (!currentPrivateLobby) return;
            
            var lobbyCode = currentPrivateLobby.code;
            var botUsername = 'pokerhouse77bot';
            
            // Use direct Mini App link with startapp parameter
            // Format: https://t.me/botusername/appname?startapp=param
            // This opens the Mini App directly without requiring a second click
            var inviteLink = 'https://t.me/' + botUsername + '/poker?startapp=lobby_' + lobbyCode;
            
            var message = 'ğŸ° Join my Private Poker Game!\n\n' +
                'ğŸ“ Lobby Code: ' + lobbyCode + '\n' +
                'ğŸ’° Buy-in: $' + currentPrivateLobby.buyIn.toLocaleString() + '\n' +
                'ğŸ¯ Blinds: $' + currentPrivateLobby.smallBlind + '/$' + currentPrivateLobby.bigBlind + '\n\n' +
                'ğŸ‘‡ Click to join:';
            
            addDebug('Invite via Telegram: ' + lobbyCode);
            
            // Build share URL - always open in new tab
            var shareUrl = 'https://t.me/share/url?url=' + encodeURIComponent(inviteLink) + '&text=' + encodeURIComponent(message);
            
            // Always open in new tab/window
            window.open(shareUrl, '_blank', 'noopener,noreferrer');
        }

        function copyLobbyLink() {
            if (!currentPrivateLobby) return;
            
            var lobbyCode = currentPrivateLobby.code;
            var botUsername = 'pokerhouse77bot';
            
            // Use direct Mini App link - opens app directly without extra click
            var inviteLink = 'https://t.me/' + botUsername + '/poker?startapp=lobby_' + lobbyCode;
            
            // Copy to clipboard
            if (navigator.clipboard) {
                navigator.clipboard.writeText(inviteLink).then(function() {
                    showAlert('ğŸ“‹ Invite link copied!\n\n' + inviteLink);
                }).catch(function() {
                    showAlert('ğŸ“‹ Lobby Code: ' + lobbyCode + '\n\nShare this code with friends!');
                });
            } else {
                // Fallback
                showAlert('ğŸ“‹ Lobby Code: ' + lobbyCode + '\n\nShare this code with friends!');
            }
        }

        function startPrivateGame() {
            if (!currentPrivateLobby) {
                showAlert('âš ï¸ No lobby to start');
                return;
            }
            
            addDebug('Starting private game: ' + currentPrivateLobby.code);
            
            // Set game state from lobby settings
            gameState.smallBlind = currentPrivateLobby.smallBlind;
            gameState.bigBlind = currentPrivateLobby.bigBlind;
            
            // Hide all screens
            document.getElementById('mainMenu').classList.add('hidden');
            document.getElementById('lobbyScreen').classList.add('hidden');
            document.getElementById('waitingRoomScreen').classList.add('hidden');
            
            // Join table with lobby settings
            joinTable({
                name: 'Private: ' + currentPrivateLobby.code,
                buyIn: '$' + currentPrivateLobby.buyIn.toLocaleString(),
                blinds: currentPrivateLobby.smallBlind + '/' + currentPrivateLobby.bigBlind
            });
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // WAITING ROOM FUNCTIONS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function goToWaitingRoom() {
            if (!currentPrivateLobby) {
                showAlert('âš ï¸ No lobby created');
                return;
            }
            
            addDebug('Going to waiting room: ' + currentPrivateLobby.code);
            
            // Close modal
            closePrivateGameModal();
            document.getElementById('mainMenu').classList.add('hidden');
            
            // Connect to WebSocket for real-time updates
            connectToLobbyWebSocket(currentPrivateLobby.code);
            
            // Update waiting room UI
            updateWaitingRoomUI();
            
            // Show waiting room
            document.getElementById('waitingRoomScreen').classList.remove('hidden');
        }

        function updateWaitingRoomUI() {
            if (!currentPrivateLobby) {
                addDebug('updateWaitingRoomUI: no lobby!');
                return;
            }
            
            addDebug('Updating UI with code: ' + currentPrivateLobby.code);
            
            var codeEl = document.getElementById('waitingLobbyCode');
            if (codeEl) {
                codeEl.textContent = currentPrivateLobby.code;
                addDebug('Set code element to: ' + currentPrivateLobby.code);
            } else {
                addDebug('ERROR: waitingLobbyCode element not found!');
            }
            document.getElementById('waitingBuyIn').textContent = '$' + currentPrivateLobby.buyIn.toLocaleString();
            document.getElementById('waitingBlinds').textContent = '$' + currentPrivateLobby.smallBlind + '/$' + currentPrivateLobby.bigBlind;
            document.getElementById('waitingMaxPlayers').textContent = currentPrivateLobby.maxPlayers;
            
            var players = currentPrivateLobby.players || [];
            var maxPlayers = currentPrivateLobby.maxPlayers || 6;
            
            document.getElementById('waitingPlayersCount').textContent = players.length + '/' + maxPlayers;
            
            // Render player slots
            var grid = document.getElementById('waitingPlayersGrid');
            var html = '';
            
            for (var i = 0; i < maxPlayers; i++) {
                var player = players[i];
                if (player) {
                    var slotClass = player.isHost ? 'waiting-player-slot host' : 'waiting-player-slot occupied';
                    html += '<div class="' + slotClass + '">' +
                        '<div class="waiting-player-avatar">' + (player.isHost ? 'ğŸ‘‘' : player.name.charAt(0)) + '</div>' +
                        '<div class="waiting-player-name">' + player.name + (player.isHost ? ' (Host)' : '') + '</div>' +
                    '</div>';
                } else {
                    html += '<div class="waiting-player-slot empty">' +
                        '<div class="waiting-player-avatar">?</div>' +
                        '<div class="waiting-player-name">Empty</div>' +
                    '</div>';
                }
            }
            
            grid.innerHTML = html;
            
            // Update start button state based on host status
            var startBtn = document.getElementById('waitingStartBtn');
            var statusEl = document.getElementById('waitingStatus');
            var isHost = currentPrivateLobby.isHost === true;
            
            // Only host can see and use Start button
            if (isHost) {
                startBtn.style.display = 'flex';
                if (players.length >= 2) {
                    startBtn.disabled = false;
                    statusEl.className = 'waiting-status ready';
                    statusEl.innerHTML = 'âœ… Ready to start!';
                } else {
                    startBtn.disabled = true;
                    statusEl.className = 'waiting-status';
                    statusEl.innerHTML = '<span class="waiting-dot">â³</span> Waiting for players to join...';
                }
            } else {
                // Guest - hide start button, show waiting message
                startBtn.style.display = 'none';
                statusEl.className = 'waiting-status';
                statusEl.innerHTML = '<span class="waiting-dot">â³</span> Waiting for host to start the game...';
            }
        }

        function leaveWaitingRoom() {
            document.getElementById('waitingRoomScreen').classList.add('hidden');
            document.getElementById('mainMenu').classList.remove('hidden');
            currentPrivateLobby = null;
        }

        async function startGameFromWaitingRoom() {
            if (!currentPrivateLobby) return;
            
            addDebug('Starting game from waiting room...');
            
            try {
                // Call server API to start game
                var response = await fetch(API_BASE + '/api/lobby/' + currentPrivateLobby.code + '/start', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        initData: tg ? tg.initData : ''
                    })
                });
                
                if (!response.ok) {
                    var errData = await response.json().catch(function() { return {}; });
                    throw new Error(errData.detail || 'Failed to start game');
                }
                
                var data = await response.json();
                addDebug('Game started on server: ' + data.gameSessionId);
                
                // Server will broadcast 'gameStarted' via WebSocket
                // which will trigger startPrivateGame() for all players
                // But host can also start immediately
                startMultiplayerGame(data.gameSessionId);
                
            } catch (err) {
                addDebug('Start game error: ' + err.message);
                showAlert('âš ï¸ ' + err.message);
            }
        }
        
        var gameWebSocket = null;
        var currentGameSession = null;
        var mySeat = null;  // My seat number (1-based)
        
        function startMultiplayerGame(gameSessionId) {
            addDebug('Starting multiplayer game: ' + gameSessionId);
            currentGameSession = gameSessionId;
            
            // Smooth transition from waiting room to poker table
            showScreen('pokerTableScreen', ['waitingRoomScreen']);
            
            var tableNameEl = document.getElementById('tableName');
            if (tableNameEl) {
                tableNameEl.textContent = 'Multiplayer: ' + (currentPrivateLobby ? currentPrivateLobby.code : '');
            }
            
            // Connect to game WebSocket after transition starts
            setTimeout(function() {
                connectToGameWebSocket(gameSessionId);
            }, 300);
            
            addDebug('Multiplayer game screen shown');
        }
        
        function connectToGameWebSocket(sessionId) {
            if (gameWebSocket) {
                gameWebSocket.close();
            }
            
            // Server will assign seat automatically based on connection order
            var wsUrl = API_BASE.replace('https://', 'wss://').replace('http://', 'ws://') + '/ws/game/' + sessionId;
            addDebug('Connecting to game WS: ' + wsUrl);
            
            try {
                gameWebSocket = new WebSocket(wsUrl);
                
                gameWebSocket.onopen = function() {
                    addDebug('Game WebSocket connected, waiting for seat assignment');
                };
                
                gameWebSocket.onmessage = function(event) {
                    try {
                        var data = JSON.parse(event.data);
                        addDebug('Game WS: ' + data.type);
                        handleGameEvent(data);
                    } catch (e) {
                        addDebug('Game WS parse error: ' + e.message);
                    }
                };
                
                gameWebSocket.onclose = function() {
                    addDebug('Game WebSocket closed');
                };
                
                gameWebSocket.onerror = function(err) {
                    addDebug('Game WebSocket error');
                };
            } catch (e) {
                addDebug('Game WS connection failed: ' + e.message);
            }
        }
        
        function handleGameEvent(data) {
            addDebug('handleGameEvent: ' + data.type);
            
            if (data.type === 'gameState') {
                if (data.yourSeat) {
                    mySeat = data.yourSeat;
                    addDebug('My seat assigned: ' + mySeat);
                }
                updateGameUI(data.game);
            } else if (data.type === 'error') {
                addDebug('Game error: ' + data.message);
                showAlert('âš ï¸ ' + data.message);
            } else if (data.type === 'pong') {
                // Heartbeat response, ignore
            } else {
                addDebug('Unknown game event: ' + data.type);
            }
        }
        
        function updateGameUI(gameState) {
            if (!gameState) return;
            
            addDebug('Updating game UI, phase: ' + gameState.phase + ', my seat: ' + mySeat);
            
            // Handle showdown/finished - show winner
            if (gameState.phase === 'showdown' || gameState.phase === 'finished') {
                if (gameState.winnerSeat && gameState.winnerHand) {
                    var winnerPlayer = gameState.players.find(function(p) {
                        return p.seat === gameState.winnerSeat;
                    });
                    if (winnerPlayer) {
                        showMultiplayerWinner(winnerPlayer, gameState.winnerHand, gameState.pot);
                    }
                }
            }
            
            // Update pot
            var potEl = document.getElementById('potAmount');
            if (potEl) {
                potEl.textContent = '$' + gameState.pot;
            }
            
            // Update phase indicator
            var phaseIndicator = document.getElementById('gamePhaseIndicator');
            if (phaseIndicator && gameState.phase) {
                var phaseDisplay = gameState.phase.toUpperCase().replace('_', '-');
                phaseIndicator.textContent = phaseDisplay;
            }
            
            // Also update header
            var headerPhase = document.getElementById('tableInfoBlinds');
            if (headerPhase && gameState.phase) {
                headerPhase.textContent = gameState.phase.toUpperCase().replace('_', '-');
            }
            
            // Update community cards - only add NEW cards to avoid re-animation
            var communityEl = document.getElementById('communityCards');
            if (communityEl && gameState.communityCards) {
                var currentCardCount = communityEl.children.length;
                var newCardCount = gameState.communityCards.length;
                
                // Only update if new cards were dealt
                if (newCardCount > currentCardCount) {
                    // Add only new cards
                    for (var i = currentCardCount; i < newCardCount; i++) {
                        var cardEl = document.createElement('div');
                        cardEl.innerHTML = createCardHTML(gameState.communityCards[i]);
                        communityEl.appendChild(cardEl.firstChild);
                    }
                } else if (newCardCount === 0 && currentCardCount > 0) {
                    // Clear cards for new hand
                    communityEl.innerHTML = '';
                }
            }
            
            // Find my player by seat
            var myPlayer = null;
            if (mySeat && gameState.players) {
                myPlayer = gameState.players.find(function(p) {
                    return p.seat === mySeat;
                });
                addDebug('My player: ' + (myPlayer ? myPlayer.name : 'not found') + ', cards: ' + (myPlayer && myPlayer.cards ? myPlayer.cards.length : 0));
            }
            
            // Update hero cards at bottom
            var heroCardsEl = document.getElementById('heroCards');
            if (heroCardsEl && myPlayer && myPlayer.cards && myPlayer.cards.length >= 2) {
                var card1 = myPlayer.cards[0];
                var card2 = myPlayer.cards[1];
                
                var color1 = (card1.suit === 'hearts' || card1.suit === 'diamonds') ? 'red' : 'black';
                var color2 = (card2.suit === 'hearts' || card2.suit === 'diamonds') ? 'red' : 'black';
                
                heroCardsEl.innerHTML = 
                    '<div class="hero-card ' + color1 + '">' +
                        '<span class="card-rank">' + formatRank(card1.rank) + '</span>' +
                        '<span class="card-suit">' + getSuitSymbol(card1.suit) + '</span>' +
                    '</div>' +
                    '<div class="hero-card ' + color2 + '">' +
                        '<span class="card-rank">' + formatRank(card2.rank) + '</span>' +
                        '<span class="card-suit">' + getSuitSymbol(card2.suit) + '</span>' +
                    '</div>';
            }
            
            // Update action buttons based on whose turn it is (using seat)
            var isMyTurn = parseInt(gameState.currentPlayerSeat) === parseInt(mySeat);
            addDebug('Current seat: ' + gameState.currentPlayerSeat + ', my seat: ' + mySeat + ', my turn: ' + isMyTurn);
            
            var actionBtns = document.querySelectorAll('.action-btn');
            actionBtns.forEach(function(btn) {
                btn.disabled = !isMyTurn;
                btn.style.opacity = isMyTurn ? '1' : '0.5';
            });
            
            // Update Call/Check button text based on current bet
            var callBtn = document.getElementById('callBtn');
            if (callBtn && myPlayer) {
                var callAmount = (gameState.currentBet || 0) - (myPlayer.currentBet || 0);
                if (callAmount <= 0) {
                    callBtn.textContent = 'Check';
                } else {
                    callBtn.textContent = 'Call $' + callAmount;
                }
            }
            
            // Update players around table
            updatePlayersDisplay(gameState.players, mySeat);
        }
        
        function createCardHTML(card) {
            var isRed = (card.suit === 'hearts' || card.suit === 'diamonds');
            var colorClass = isRed ? 'red' : 'black';
            var suitSymbol = getSuitSymbol(card.suit);
            var rank = formatRank(card.rank);
            
            return '<div class="community-card ' + colorClass + '">' +
                '<span class="card-rank">' + rank + '</span>' +
                '<span class="card-suit">' + suitSymbol + '</span>' +
            '</div>';
        }
        
        function getSuitSymbol(suit) {
            var symbols = { hearts: 'â™¥', diamonds: 'â™¦', clubs: 'â™£', spades: 'â™ ' };
            return symbols[suit] || suit;
        }
        
        function formatRank(rank) {
            // Convert numeric rank to display value
            var rankMap = { 14: 'A', 13: 'K', 12: 'Q', 11: 'J', 10: '10' };
            return rankMap[rank] || rank;
        }
        
        function updatePlayersDisplay(players, mySeat) {
            // Render all opponents around the table based on total player count
            var seatsEl = document.getElementById('playerSeats');
            if (!seatsEl || !players) return;
            
            var myCurrentSeat = parseInt(mySeat);
            var totalPlayers = players.length;
            
            // Get opponents (everyone except me)
            var opponents = players.filter(function(p) {
                return parseInt(p.seat) !== myCurrentSeat;
            });
            
            // Get position layout based on total players
            var positions = getPositionsForPlayerCount(totalPlayers, myCurrentSeat);
            
            var html = '';
            opponents.forEach(function(player, index) {
                var positionClass = positions[index] || 'position-top';
                var foldedClass = player.isFolded ? ' folded' : '';
                var isCurrentTurn = player.isCurrentTurn ? ' current-turn' : '';
                var betAmount = player.currentBet || 0;
                
                html += '<div class="table-player ' + positionClass + foldedClass + isCurrentTurn + '">' +
                    '<div class="player-avatar">' + (player.name ? player.name.charAt(0).toUpperCase() : '?') + '</div>' +
                    '<div class="player-info">' +
                        '<div class="player-name">' + (player.name || 'Player') + '</div>' +
                        '<div class="player-chips">$' + (player.chips || 0) + '</div>' +
                        (betAmount > 0 ? '<div class="player-bet">$' + betAmount + '</div>' : '') +
                    '</div>' +
                    '<div class="player-cards-back">' +
                        '<div class="card-back"></div>' +
                        '<div class="card-back"></div>' +
                    '</div>' +
                '</div>';
            });
            
            seatsEl.innerHTML = html;
            addDebug('Rendered ' + opponents.length + ' opponents at positions: ' + positions.join(', '));
        }
        
        function getPositionsForPlayerCount(totalPlayers, mySeat) {
            // Position opponents based on total player count
            // Hero is always at bottom center
            
            if (totalPlayers === 2) {
                // Heads-up: opponent at top
                return ['position-top'];
            } else if (totalPlayers === 3) {
                // 3 players: one top, one side
                return ['position-top', 'position-left'];
            } else if (totalPlayers === 4) {
                // 4 players: top, left, right
                return ['position-top', 'position-left', 'position-right'];
            } else if (totalPlayers === 5) {
                // 5 players: top, top-left, left, right
                return ['position-top', 'position-top-left', 'position-left', 'position-right'];
            } else {
                // 6 players: top, top-left, top-right, left, right
                return ['position-top', 'position-top-left', 'position-top-right', 'position-left', 'position-right'];
            }
        }
        
        // Multiplayer winner display
        var multiplayerWinnerShown = false;
        
        function showMultiplayerWinner(winner, handName, potAmount) {
            if (multiplayerWinnerShown) return;
            multiplayerWinnerShown = true;
            
            addDebug('WINNER: ' + winner.name + ' with ' + handName);
            
            // Use existing winner popup if available
            var popup = document.getElementById('winnerPopup');
            if (popup) {
                var nameEl = popup.querySelector('.winner-name, #winnerName');
                var handEl = popup.querySelector('.winner-hand, #winnerHand');
                var potEl = popup.querySelector('.winner-pot, #winnerPot');
                
                if (nameEl) nameEl.textContent = winner.name + ' WINS!';
                if (handEl) handEl.textContent = handName;
                if (potEl) potEl.textContent = '+$' + potAmount;
                
                popup.classList.remove('hidden');
                popup.style.display = 'flex';
            } else {
                // Create simple alert
                showAlert('ğŸ† ' + winner.name + ' wins with ' + handName + '! (+$' + potAmount + ')');
            }
            
            // Request new hand after delay
            setTimeout(function() {
                multiplayerWinnerShown = false;
                if (popup) {
                    popup.classList.add('hidden');
                    popup.style.display = 'none';
                }
                requestNewHand();
            }, 4000);
        }
        
        function requestNewHand() {
            if (gameWebSocket && gameWebSocket.readyState === WebSocket.OPEN) {
                addDebug('Requesting new hand');
                gameWebSocket.send(JSON.stringify({ type: 'new_hand' }));
            }
        }
        
        // Game action functions for multiplayer
        function sendGameAction(action, amount) {
            if (!currentGameSession) {
                addDebug('No game session for action!');
                return;
            }
            
            addDebug('sendGameAction: ' + action + ', amount: ' + amount + ', WS state: ' + (gameWebSocket ? gameWebSocket.readyState : 'null'));
            
            if (gameWebSocket && gameWebSocket.readyState === WebSocket.OPEN) {
                var msg = {
                    type: 'action',
                    action: action,
                    amount: amount || 0
                };
                addDebug('WS sending: ' + JSON.stringify(msg));
                gameWebSocket.send(JSON.stringify(msg));
            } else {
                addDebug('WS not open, using HTTP fallback');
                // Fallback to HTTP
                fetch(API_BASE + '/api/game/' + currentGameSession + '/action', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        action: action,
                        amount: amount || 0,
                        initData: tg ? tg.initData : ''
                    })
                }).then(function(resp) {
                    return resp.json();
                }).then(function(data) {
                    if (data.game) {
                        updateGameUI(data.game);
                    }
                }).catch(function(err) {
                    addDebug('Action error: ' + err.message);
                });
            }
        }
        
        // Override action button handlers for multiplayer
        function handleMultiplayerFold() {
            sendGameAction('fold', 0);
        }
        
        function handleMultiplayerCheck() {
            sendGameAction('check', 0);
        }
        
        function handleMultiplayerCall() {
            sendGameAction('call', 0);
        }
        
        function handleMultiplayerRaise(amount) {
            sendGameAction('raise', amount);
        }
        
        function handleMultiplayerAllIn() {
            sendGameAction('all_in', 0);
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // URL PARAMETER HANDLING FOR LOBBY INVITE
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function checkUrlForLobby() {
            var lobbyCode = null;
            
            // Check Telegram WebApp startapp parameter first (highest priority)
            // This is set when user clicks direct Mini App link: t.me/bot/app?startapp=lobby_XXXXX
            if (tg && tg.initDataUnsafe && tg.initDataUnsafe.start_param) {
                var startParam = tg.initDataUnsafe.start_param;
                addDebug('TG start_param: ' + startParam);
                
                if (startParam.startsWith('lobby_')) {
                    lobbyCode = startParam.replace('lobby_', '');
                }
            }
            
            // Fallback: check URL parameter
            if (!lobbyCode) {
                var urlParams = new URLSearchParams(window.location.search);
                lobbyCode = urlParams.get('lobby');
            }
            
            if (lobbyCode) {
                addDebug('Lobby code found: ' + lobbyCode);
                joinLobbyByCode(lobbyCode);
            }
        }

        async function joinLobbyByCode(code) {
            code = code.toUpperCase().trim();
            addDebug('Joining lobby by code: ' + code);
            
            try {
                // First get lobby info from server
                var lobbyResponse = await fetch(API_BASE + '/api/lobby/' + code);
                
                if (!lobbyResponse.ok) {
                    var errData = await lobbyResponse.json().catch(function() { return {}; });
                    throw new Error(errData.detail || 'Lobby not found');
                }
                
                var lobbyData = await lobbyResponse.json();
                addDebug('Found lobby: ' + JSON.stringify(lobbyData.lobby));
                
                // Join the lobby
                var joinResponse = await fetch(API_BASE + '/api/lobby/' + code + '/join', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        initData: tg ? tg.initData : ''
                    })
                });
                
                if (!joinResponse.ok) {
                    var joinErr = await joinResponse.json().catch(function() { return {}; });
                    throw new Error(joinErr.detail || 'Failed to join lobby');
                }
                
                var joinData = await joinResponse.json();
                var serverLobby = joinData.lobby;
                
                addDebug('Joined lobby successfully');
                
                // Convert server players to our format
                // Server returns array of players, not object
                var players = [];
                if (serverLobby.players && Array.isArray(serverLobby.players)) {
                    serverLobby.players.forEach(function(p) {
                        var isPlayerHost = (p.telegramId === serverLobby.hostTelegramId);
                        players.push({
                            name: p.firstName || p.username || 'Player',
                            isHost: isPlayerHost
                        });
                    });
                }
                addDebug('Parsed players: ' + JSON.stringify(players));
                
                currentPrivateLobby = {
                    code: code,
                    buyIn: serverLobby.buyIn || serverLobby.buy_in || 100,
                    maxPlayers: serverLobby.maxPlayers || serverLobby.max_players || 2,
                    smallBlind: serverLobby.smallBlind || 10,
                    bigBlind: serverLobby.bigBlind || 20,
                    players: players,
                    serverData: serverLobby,
                    isHost: false  // Joining player is NOT the host
                };
                
                // Skip splash/main menu and go directly to waiting room
                document.getElementById('splashScreen').style.display = 'none';
                document.getElementById('mainMenu').classList.add('hidden');
                document.getElementById('fullscreenRequestScreen').classList.add('hidden');
                
                // Connect to WebSocket for real-time updates
                connectToLobbyWebSocket(code);
                
                // Show waiting room
                updateWaitingRoomUI();
                document.getElementById('waitingRoomScreen').classList.remove('hidden');
                
            } catch (err) {
                addDebug('Join lobby error: ' + err.message);
                showAlert('âš ï¸ ' + err.message);
                
                // Show main menu if join failed
                document.getElementById('splashScreen').style.display = 'none';
                document.getElementById('mainMenu').classList.remove('hidden');
            }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // WEBSOCKET FOR REAL-TIME LOBBY UPDATES
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        var lobbyWebSocket = null;
        
        function connectToLobbyWebSocket(lobbyCode) {
            if (lobbyWebSocket) {
                lobbyWebSocket.close();
            }
            
            var wsUrl = API_BASE.replace('https://', 'wss://').replace('http://', 'ws://') + '/ws/lobby/' + lobbyCode;
            addDebug('Connecting to WebSocket: ' + wsUrl);
            
            try {
                lobbyWebSocket = new WebSocket(wsUrl);
                
                lobbyWebSocket.onopen = function() {
                    addDebug('WebSocket connected');
                };
                
                lobbyWebSocket.onmessage = function(event) {
                    try {
                        var data = JSON.parse(event.data);
                        addDebug('WS message: ' + data.type);
                        handleLobbyEvent(data);
                    } catch (e) {
                        addDebug('WS parse error: ' + e.message);
                    }
                };
                
                lobbyWebSocket.onclose = function() {
                    addDebug('WebSocket closed');
                };
                
                lobbyWebSocket.onerror = function(err) {
                    addDebug('WebSocket error');
                };
            } catch (e) {
                addDebug('WebSocket connection failed: ' + e.message);
            }
        }
        
        function handleLobbyEvent(data) {
            if (!currentPrivateLobby) return;
            
            switch (data.type) {
                case 'playerJoined':
                    // Add new player
                    if (data.player) {
                        currentPrivateLobby.players.push({
                            name: data.player.first_name || data.player.username || 'Player',
                            isHost: data.player.is_host
                        });
                        updateWaitingRoomUI();
                        addDebug('Player joined: ' + (data.player.first_name || 'Player'));
                    }
                    break;
                    
                case 'playerLeft':
                    // Remove player (simplified - just refresh)
                    addDebug('Player left');
                    break;
                    
                case 'gameStarted':
                    addDebug('Game started by host! Session: ' + data.gameSessionId);
                    startMultiplayerGame(data.gameSessionId);
                    break;
                    
                case 'lobbyState':
                    // Full state update - sync ALL lobby data from server
                    if (data.lobby) {
                        var serverLobby = data.lobby;
                        
                        // Update lobby settings from server
                        currentPrivateLobby.buyIn = serverLobby.buyIn || serverLobby.buy_in || currentPrivateLobby.buyIn;
                        currentPrivateLobby.maxPlayers = serverLobby.maxPlayers || serverLobby.max_players || currentPrivateLobby.maxPlayers;
                        
                        // Parse players (could be array or object)
                        var players = [];
                        if (Array.isArray(serverLobby.players)) {
                            serverLobby.players.forEach(function(p) {
                                players.push({
                                    name: p.firstName || p.first_name || p.username || 'Player',
                                    isHost: p.telegramId === serverLobby.hostTelegramId
                                });
                            });
                        } else if (serverLobby.players) {
                            for (var pid in serverLobby.players) {
                                var p = serverLobby.players[pid];
                                players.push({
                                    name: p.firstName || p.first_name || p.username || 'Player',
                                    isHost: p.is_host
                                });
                            }
                        }
                        currentPrivateLobby.players = players;
                        addDebug('Lobby synced: buyIn=' + currentPrivateLobby.buyIn + ', max=' + currentPrivateLobby.maxPlayers);
                        updateWaitingRoomUI();
                    }
                    break;
            }
        }

        // Check for lobby code on page load
        window.addEventListener('load', function() {
            addDebug('Window loaded');
            setTimeout(function() {
                checkUrlForLobby();
            }, 500);
        });

        // Fallback: Force show main menu after 5 seconds if nothing is visible
        function forceShowMainMenu() {
            var splash = document.getElementById('splashScreen');
            var menu = document.getElementById('mainMenu');
            var fullscreen = document.getElementById('fullscreenRequestScreen');
            var waiting = document.getElementById('waitingRoomScreen');
            var poker = document.getElementById('pokerTableScreen');
            
            // Check if any screen is visible
            var anyVisible = false;
            if (menu && !menu.classList.contains('hidden')) anyVisible = true;
            if (waiting && !waiting.classList.contains('hidden')) anyVisible = true;
            if (poker && !poker.classList.contains('hidden')) anyVisible = true;
            
            // Force show menu if nothing is visible
            if (!anyVisible) {
                addDebug('Fallback: forcing main menu');
                if (splash) splash.style.display = 'none';
                if (fullscreen) fullscreen.classList.add('hidden');
                if (menu) menu.classList.remove('hidden');
                try { updateUserUI(); } catch(e) {}
            }
        }
        
        // Quick fallback after 3 seconds
        setTimeout(forceShowMainMenu, 3000);
        
        // Backup fallback after 5 seconds
        setTimeout(forceShowMainMenu, 5000);

        addDebug('Ready');
    </script>
</body>
</html>
